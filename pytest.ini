[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# 性能优化配置
addopts =
    -v
    --strict-markers
    --tb=short
    --cov=core
    --cov=pages
    --cov-report=term-missing
    --cov-report=html
    # 并行测试优化
    --dist=loadscope
    --maxfail=5
    # 性能追踪
    --durations=10
    # 失败重试
    --reruns=2
    --reruns-delay=1

markers =
    unit: 单元测试（快速）
    integration: 集成测试（中速）
    e2e: 端到端测试（慢速）
    slow: 慢速测试（>30s）
    fast: 快速测试（<5s）
    product_id: 指定商品 ID 的测试
    priority: 测试优先级标记 (P0/P1/P2)
    asyncio: 异步测试标记
    flaky: 不稳定测试（需要重试）

# 并行测试配置
# 使用 pytest-xdist 自动检测 CPU 核心数
# 运行时使用: pytest -n auto 或 pytest -n 4

[coverage:run]
source = core,pages
omit =
    */tests/*
    */venv/*
    */__pycache__/*
    */conftest.py
parallel = True

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
fail_under = 80

[coverage:html]
directory = htmlcov
