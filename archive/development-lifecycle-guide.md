# Fiido ç”µå•†E2Eæµ‹è¯• - é€šç”¨è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶å¼€å‘æŒ‡å—

> **é¡¹ç›®åç§°**: Fiido Shop Flow Guardian - é€šç”¨ç”µå•†æµ‹è¯•è‡ªåŠ¨åŒ–æ¡†æ¶
> **ç‰ˆæœ¬**: 2.0ï¼ˆé€šç”¨åŒ–ã€å¯æ‰©å±•ç‰ˆæœ¬ï¼‰
> **åˆ›å»ºæ—¶é—´**: 2025-12-01
> **ç›®æ ‡ç½‘ç«™**: https://fiido.comï¼ˆåŸºäºShopifyå¹³å°ï¼‰
> **æ¡†æ¶ç‰¹ç‚¹**: é…ç½®é©±åŠ¨ã€URLè‡ªåŠ¨å‘ç°ã€ä¸€é”®æ‰©å±•æ–°äº§å“
> **å¼€å‘æ–¹æ³•**: æ¸è¿›å¼å¢é‡å¼€å‘

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [ç¯å¢ƒè¦æ±‚](#2-ç¯å¢ƒè¦æ±‚)
3. [æŠ€æœ¯æ ˆ](#3-æŠ€æœ¯æ ˆ)
4. [æ¡†æ¶è®¾è®¡ç†å¿µ](#4-æ¡†æ¶è®¾è®¡ç†å¿µ)
5. [å¼€å‘é˜¶æ®µ](#5-å¼€å‘é˜¶æ®µ)
6. [è¿­ä»£è§„åˆ’](#6-è¿­ä»£è§„åˆ’)
7. [æ ¸å¿ƒç»„ä»¶è®¾è®¡](#7-æ ¸å¿ƒç»„ä»¶è®¾è®¡)
8. [ä½¿ç”¨æŒ‡å—](#8-ä½¿ç”¨æŒ‡å—)
9. [ç”¨æˆ·ç•Œé¢ï¼ˆéæŠ€æœ¯äººå‘˜ä½¿ç”¨ï¼‰](#9-ç”¨æˆ·ç•Œé¢éæŠ€æœ¯äººå‘˜ä½¿ç”¨)
10. [éƒ¨ç½²æ–¹æ¡ˆ](#10-éƒ¨ç½²æ–¹æ¡ˆ)
11. [éƒ¨ç½²æµæ°´çº¿](#11-éƒ¨ç½²æµæ°´çº¿)
12. [è´¨é‡é—¨ç¦](#12-è´¨é‡é—¨ç¦)
13. [æ‰©å±•æŒ‡å—](#13-æ‰©å±•æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

ä¸ºFiidoç”µå•†ç‹¬ç«‹ç«™ï¼ˆhttps://fiido.comï¼‰æ„å»º**é€šç”¨åŒ–ã€å¯æ‰©å±•**çš„E2Eè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ã€‚

**ç›®æ ‡ç½‘ç«™ä¿¡æ¯**ï¼š
- **ä¸»ç«™**: https://fiido.com
- **å¹³å°**: Shopifyç”µå•†å¹³å°
- **äº§å“**: ç”µåŠ¨è‡ªè¡Œè½¦åŠé…ä»¶
- **ç‰¹ç‚¹**: å›½é™…åŒ–ã€å¤šåœ°åŒºé…é€ã€å¤šæ”¯ä»˜æ–¹å¼ï¼ˆPayPalã€Klarnaã€Shop Payï¼‰

**æ ¸å¿ƒç›®æ ‡**ï¼š
- âœ… **é€šç”¨åŒ–è®¾è®¡**: ä»…éœ€æä¾›äº§å“URLï¼Œè‡ªåŠ¨å®Œæˆå®Œæ•´æµ‹è¯•
- âœ… **è‡ªåŠ¨å‘ç°**: çˆ¬å–ç½‘ç«™ç»“æ„ï¼Œè‡ªåŠ¨å‘ç°æ‰€æœ‰å•†å“å’Œåˆ†ç±»
- âœ… **é…ç½®é©±åŠ¨**: é€šè¿‡JSONé…ç½®æ–‡ä»¶æ§åˆ¶æµ‹è¯•èŒƒå›´å’Œè¡Œä¸º
- âœ… **ä¸€é”®æ‰©å±•**: æ–°äº§å“ä¸Šçº¿æ—¶ï¼Œä»…éœ€æ›´æ–°é…ç½®æˆ–æä¾›URL
- âœ… **AIæ™ºèƒ½åˆ†æ**: è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šå’Œå¤±è´¥åˆ†æ
- âœ… **7x24ç›‘æ§**: å…¨å¤©å€™è‡ªåŠ¨è¿è¡Œï¼Œå³æ—¶å‘ç°é—®é¢˜

### 1.2 è®¾è®¡æ ¸å¿ƒç†å¿µ

**é—®é¢˜**: ä¼ ç»ŸE2Eæµ‹è¯•éœ€è¦ä¸ºæ¯ä¸ªæ–°äº§å“æ‰‹åŠ¨ç¼–å†™æµ‹è¯•ä»£ç 
**è§£å†³æ–¹æ¡ˆ**: æ„å»ºæŠ½è±¡å±‚ï¼Œé€šè¿‡é…ç½®å’ŒURLè‡ªåŠ¨åŒ–æµ‹è¯•

```
                    ä¼ ç»Ÿæ–¹å¼                           é€šç”¨æ¡†æ¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°äº§å“ä¸Šçº¿                        â”‚    â”‚ æ–°äº§å“ä¸Šçº¿                        â”‚
â”‚   â†“                              â”‚    â”‚   â†“                              â”‚
â”‚ QAæ‰‹åŠ¨ç¼–å†™æµ‹è¯•ä»£ç                 â”‚    â”‚ æ·»åŠ äº§å“URLåˆ°é…ç½®æ–‡ä»¶             â”‚
â”‚   â†“                              â”‚    â”‚   â†“                              â”‚
â”‚ è°ƒè¯•æµ‹è¯•è„šæœ¬                      â”‚    â”‚ æ¡†æ¶è‡ªåŠ¨çˆ¬å–äº§å“ä¿¡æ¯              â”‚
â”‚   â†“                              â”‚    â”‚   â†“                              â”‚
â”‚ éƒ¨ç½²åˆ°CI/CD                       â”‚    â”‚ è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹                  â”‚
â”‚   â†“                              â”‚    â”‚   â†“                              â”‚
â”‚ è¿è¡Œæµ‹è¯•ï¼ˆè€—æ—¶1-2å¤©ï¼‰             â”‚    â”‚ ç«‹å³æ‰§è¡Œæµ‹è¯•ï¼ˆè€—æ—¶5åˆ†é’Ÿï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
1. **é›¶ä»£ç æ‰©å±•**: æ–°äº§å“ä»…éœ€é…ç½®URL
2. **è‡ªåŠ¨æŠ½è±¡**: æ¡†æ¶è‡ªåŠ¨è¯†åˆ«å•†å“å±æ€§ï¼ˆä»·æ ¼ã€å˜ä½“ã€åº“å­˜ç­‰ï¼‰
3. **æ™ºèƒ½é€‚é…**: è‡ªåŠ¨å¤„ç†ä¸åŒå•†å“ç±»å‹ï¼ˆè‡ªè¡Œè½¦ã€é…ä»¶ã€å‘¨è¾¹ï¼‰
4. **çµæ´»é…ç½®**: æŒ‰ä¼˜å…ˆçº§ã€åœ°åŒºã€ç±»å‹è¿‡æ»¤æµ‹è¯•

### 1.3 å®é™…ä½¿ç”¨åœºæ™¯

#### åœºæ™¯1: æ–°äº§å“ä¸Šçº¿æµ‹è¯•
```bash
# ä»…éœ€ä¸€æ¡å‘½ä»¤
python scripts/add_product.py --url "https://fiido.com/products/fiido-x-pro"

# æ¡†æ¶è‡ªåŠ¨ï¼š
# 1. çˆ¬å–äº§å“é¡µé¢ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€ä»·æ ¼ã€å˜ä½“ã€å›¾ç‰‡ï¼‰
# 2. ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
# 3. æ‰§è¡Œå®Œæ•´æµç¨‹æµ‹è¯•ï¼ˆæµè§ˆâ†’åŠ è´­â†’ç»“è´¦ï¼‰
# 4. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
```

#### åœºæ™¯2: å…¨ç«™å•†å“æµ‹è¯•
```bash
# è‡ªåŠ¨å‘ç°æ‰€æœ‰å•†å“å¹¶æµ‹è¯•
python scripts/discover_and_test.py --base-url "https://fiido.com"

# æ¡†æ¶è‡ªåŠ¨ï¼š
# 1. çˆ¬å–æ‰€æœ‰å•†å“åˆ†ç±»ï¼ˆ/collectionsï¼‰
# 2. çˆ¬å–æ¯ä¸ªåˆ†ç±»ä¸‹çš„æ‰€æœ‰å•†å“
# 3. ç”Ÿæˆå…¨é‡æµ‹è¯•å¥—ä»¶
# 4. å¹¶è¡Œæ‰§è¡Œæµ‹è¯•
# 5. AIåˆ†æç»“æœå¹¶å‘Šè­¦
```

#### åœºæ™¯3: ç‰¹å®šåˆ†ç±»æµ‹è¯•
```bash
# ä»…æµ‹è¯•ç”µåŠ¨è‡ªè¡Œè½¦åˆ†ç±»
pytest tests/ --collection="electric-bikes" --priority=P0
```

---

## 2. ç¯å¢ƒè¦æ±‚

### 2.1 å¼€å‘ç¯å¢ƒ

**æ¨èé…ç½®**ï¼ˆæ‚¨çš„ç¯å¢ƒï¼‰ï¼š
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 LTSï¼ˆâœ… æœ€ä½³é€‰æ‹©ï¼‰
- **Python**: 3.11+
- **å†…å­˜**: 8GB+ï¼ˆæœ€ä½4GBï¼‰
- **ç£ç›˜**: 10GB+ï¼ˆåŒ…å«ä¾èµ–å’Œæµè§ˆå™¨ï¼‰
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

**å¼€å‘å·¥å…·**ï¼š
```bash
# å¿…éœ€å·¥å…·
sudo apt update
sudo apt install -y python3.11 python3.11-venv python3-pip git

# å¯é€‰å·¥å…·ï¼ˆæ¨èï¼‰
sudo apt install -y curl wget jq  # å‘½ä»¤è¡Œå·¥å…·
```

### 2.2 ä½¿ç”¨ç¯å¢ƒï¼ˆè·¨å¹³å°æ”¯æŒï¼‰

**âœ… æ”¯æŒçš„æ“ä½œç³»ç»Ÿ**ï¼š

| æ“ä½œç³»ç»Ÿ | æ”¯æŒçŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|
| **Ubuntu 22.04/20.04** | âœ… å®Œå…¨æ”¯æŒ | æ¨èï¼ˆå¼€å‘ç¯å¢ƒï¼‰ |
| **Ubuntu 18.04** | âœ… æ”¯æŒ | éœ€è¦å‡çº§Pythonåˆ°3.11 |
| **macOS 12+** | âœ… å®Œå…¨æ”¯æŒ | Intelå’ŒApple Siliconå‡æ”¯æŒ |
| **Windows 10/11** | âœ… æ”¯æŒ | ä½¿ç”¨WSL2ï¼ˆæ¨èï¼‰æˆ–åŸç”ŸPython |
| **CentOS/RHEL 8+** | âœ… æ”¯æŒ | éœ€è¦é¢å¤–é…ç½® |
| **Dockerå®¹å™¨** | âœ… å®Œå…¨æ”¯æŒ | æœ€ä½³è·¨å¹³å°æ–¹æ¡ˆ |

**Windowsç”¨æˆ·ç‰¹åˆ«è¯´æ˜**ï¼š
```powershell
# æ–¹æ¡ˆ1: WSL2ï¼ˆæ¨èï¼‰
wsl --install -d Ubuntu-22.04
# ç„¶ååœ¨WSLä¸­æŒ‰ç…§Ubuntuæµç¨‹å®‰è£…

# æ–¹æ¡ˆ2: åŸç”ŸWindows
# ä¸‹è½½Python 3.11: https://www.python.org/downloads/
# å®‰è£…åä½¿ç”¨PowerShellæˆ–CMD
python --version
pip install -r requirements.txt
playwright install chromium
```

### 2.3 æµè§ˆå™¨è¦æ±‚

**è‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰**ï¼š
```bash
# Playwrightä¼šè‡ªåŠ¨ä¸‹è½½æ‰€éœ€æµè§ˆå™¨
playwright install chromium  # çº¦150MB
playwright install firefox   # çº¦75MBï¼ˆå¯é€‰ï¼‰
playwright install webkit    # çº¦50MBï¼ˆå¯é€‰ï¼‰
```

**ç³»ç»Ÿä¾èµ–ï¼ˆLinuxï¼‰**ï¼š
```bash
# Ubuntu/Debian
playwright install-deps chromium

# æˆ–æ‰‹åŠ¨å®‰è£…
sudo apt install -y \
  libnss3 libnspr4 libatk1.0-0 libatk-bridge2.0-0 \
  libcups2 libdrm2 libxkbcommon0 libxcomposite1 \
  libxdamage1 libxfixes3 libxrandr2 libgbm1 libasound2
```

### 2.4 ç½‘ç»œè¦æ±‚

| éœ€æ±‚ | è¯´æ˜ |
|------|------|
| **å¤–ç½‘è®¿é—®** | å¿…éœ€ï¼ˆè®¿é—®fiido.comå’ŒClaude APIï¼‰ |
| **å¸¦å®½** | æœ€ä½2Mbpsï¼Œæ¨è10Mbps+ |
| **é˜²ç«å¢™** | å…è®¸HTTPSå‡ºç«™ï¼ˆ443ç«¯å£ï¼‰ |
| **ä»£ç†** | æ”¯æŒï¼ˆéœ€é…ç½®ç¯å¢ƒå˜é‡ï¼‰ |

**ä»£ç†é…ç½®ç¤ºä¾‹**ï¼š
```bash
export HTTP_PROXY=http://proxy.company.com:8080
export HTTPS_PROXY=http://proxy.company.com:8080
export NO_PROXY=localhost,127.0.0.1
```

### 2.5 èµ„æºå ç”¨

**å¼€å‘æ—¶**ï¼š
- CPU: 2æ ¸å¿ƒï¼ˆ4æ ¸å¿ƒæ¨èï¼‰
- å†…å­˜: 4GBï¼ˆ8GBæ¨èï¼‰
- ç£ç›˜: 5GBï¼ˆä»£ç +ä¾èµ–+æµè§ˆå™¨ï¼‰

**è¿è¡Œæµ‹è¯•æ—¶**ï¼š
- CPU: 80-100%ï¼ˆå¹¶è¡Œæµ‹è¯•æ—¶ï¼‰
- å†…å­˜: 2-4GBï¼ˆå–å†³äºå¹¶è¡Œæ•°é‡ï¼‰
- ç½‘ç»œ: 1-5Mbpsï¼ˆä¸‹è½½ç½‘é¡µå†…å®¹ï¼‰

**CI/CDç¯å¢ƒ**ï¼š
- GitHub Actionså…è´¹é¢åº¦ï¼š2000åˆ†é’Ÿ/æœˆ
- é¢„è®¡æ¶ˆè€—ï¼šçº¦300-400åˆ†é’Ÿ/æœˆï¼ˆæ¯æ—¥è¿è¡Œï¼‰

### 2.6 éæŠ€æœ¯äººå‘˜ä½¿ç”¨ç¯å¢ƒ

**é€‰é¡¹1: Webç•Œé¢ï¼ˆæ¨èï¼‰**
- æµè§ˆå™¨ï¼šChrome/Firefox/Safariæœ€æ–°ç‰ˆ
- æ— éœ€å®‰è£…ä»»ä½•è½¯ä»¶
- é€šè¿‡æµè§ˆå™¨è®¿é—®Webç•Œé¢

**é€‰é¡¹2: æ¡Œé¢åº”ç”¨**
- Windows 10/11ï¼ˆ64ä½ï¼‰
- macOS 10.15+
- Ubuntu 20.04+
- çº¦200MBå®‰è£…åŒ…

**é€‰é¡¹3: åœ¨çº¿æœåŠ¡**
- æ— éœ€æœ¬åœ°ç¯å¢ƒ
- ä»…éœ€æµè§ˆå™¨å’Œç½‘ç»œ
- æŒ‰æœˆè®¢é˜…æ¨¡å¼

---

## 3. æŠ€æœ¯æ ˆ

### 2.1 æ ¸å¿ƒæ¡†æ¶

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **æµ‹è¯•æ¡†æ¶** | Playwright | Latest | æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| **æµ‹è¯•è¿è¡Œå™¨** | Pytest | 7.x+ | æµ‹è¯•æ‰§è¡Œä¸ç»„ç»‡ |
| **å¼€å‘è¯­è¨€** | Python | 3.11+ | ä¸»è¦ç¼–ç¨‹è¯­è¨€ |
| **ç½‘é¡µçˆ¬è™«** | BeautifulSoup4 + Requests | Latest | è‡ªåŠ¨å‘ç°å•†å“ |
| **é…ç½®ç®¡ç†** | JSON Schema | - | éªŒè¯é…ç½®æ–‡ä»¶ |
| **AIåˆ†æ** | Claude API | Sonnet 4.5 | æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ |
| **CI/CD** | GitHub Actions | N/A | è‡ªåŠ¨åŒ–è°ƒåº¦ |

### 2.2 å¼€å‘ä¾èµ–

```txt
# requirements.txt
playwright>=1.40.0
pytest>=7.4.0
pytest-playwright>=0.4.3
pytest-rerunfailures>=12.0
pytest-xdist>=3.5.0          # å¹¶è¡Œæµ‹è¯•
beautifulsoup4>=4.12.0       # ç½‘é¡µè§£æ
requests>=2.31.0
anthropic>=0.18.0
python-dotenv>=1.0.0
jsonschema>=4.20.0           # é…ç½®éªŒè¯
pydantic>=2.5.0              # æ•°æ®éªŒè¯
```

---

## 3. æ¡†æ¶è®¾è®¡ç†å¿µ

### 3.1 ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é…ç½®å±‚ï¼ˆConfig Layerï¼‰                   â”‚
â”‚  - äº§å“é…ç½®ï¼ˆproducts.jsonï¼‰                                â”‚
â”‚  - æµ‹è¯•ç­–ç•¥é…ç½®ï¼ˆtest_strategy.jsonï¼‰                       â”‚
â”‚  - é€‰æ‹©å™¨é…ç½®ï¼ˆselectors.jsonï¼‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æŠ½è±¡å±‚ï¼ˆAbstraction Layerï¼‰                â”‚
â”‚  - äº§å“çˆ¬è™«ï¼ˆProductCrawlerï¼‰                               â”‚
â”‚  - é¡µé¢å¯¹è±¡æ¨¡å‹ï¼ˆPageObjectModelï¼‰                          â”‚
â”‚  - æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨ï¼ˆTestGeneratorï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ‰§è¡Œå±‚ï¼ˆExecution Layerï¼‰                  â”‚
â”‚  - Playwrightæµ‹è¯•å¼•æ“                                       â”‚
â”‚  - å¹¶è¡Œæµ‹è¯•è°ƒåº¦å™¨                                           â”‚
â”‚  - ç»“æœæ”¶é›†å™¨                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒç»„ä»¶

#### ç»„ä»¶1: äº§å“çˆ¬è™«ï¼ˆProduct Crawlerï¼‰

**åŠŸèƒ½**: è‡ªåŠ¨å‘ç°å¹¶æå–å•†å“ä¿¡æ¯

```python
# æ–‡ä»¶: core/crawler.py

class ProductCrawler:
    """è‡ªåŠ¨çˆ¬å–Fiidoç½‘ç«™å•†å“ä¿¡æ¯"""

    def discover_all_products(self, base_url: str) -> List[Product]:
        """
        ä»ç½‘ç«™è‡ªåŠ¨å‘ç°æ‰€æœ‰å•†å“

        æ­¥éª¤:
        1. è®¿é—® /collections è·å–æ‰€æœ‰åˆ†ç±»
        2. éå†æ¯ä¸ªåˆ†ç±»ï¼Œè·å–å•†å“åˆ—è¡¨
        3. è®¿é—®æ¯ä¸ªå•†å“é¡µï¼Œæå–è¯¦ç»†ä¿¡æ¯
        4. è¿”å›ç»“æ„åŒ–çš„å•†å“åˆ—è¡¨
        """
        pass

    def extract_product_info(self, product_url: str) -> Product:
        """
        æå–å•ä¸ªå•†å“çš„è¯¦ç»†ä¿¡æ¯

        æå–å†…å®¹:
        - å•†å“åç§°ã€ä»·æ ¼ã€è´§å¸
        - å˜ä½“ï¼ˆé¢œè‰²ã€å°ºå¯¸ç­‰ï¼‰
        - åº“å­˜çŠ¶æ€
        - å•†å“æè¿°
        - å›¾ç‰‡URL
        - å…³é”®å…ƒç´ çš„CSSé€‰æ‹©å™¨
        """
        pass
```

**æ•°æ®æ¨¡å‹**:
```python
# æ–‡ä»¶: core/models.py

from pydantic import BaseModel, HttpUrl
from typing import List, Optional, Dict

class ProductVariant(BaseModel):
    """å•†å“å˜ä½“"""
    name: str                    # å˜ä½“åç§°ï¼ˆå¦‚"Black"ï¼‰
    type: str                    # å˜ä½“ç±»å‹ï¼ˆå¦‚"color"ï¼‰
    selector: str                # CSSé€‰æ‹©å™¨
    available: bool = True       # æ˜¯å¦æœ‰è´§

class Product(BaseModel):
    """å•†å“æ•°æ®æ¨¡å‹"""
    id: str                      # å•†å“å”¯ä¸€æ ‡è¯†
    name: str                    # å•†å“åç§°
    url: HttpUrl                 # å•†å“URL
    price_min: float             # æœ€ä½ä»·æ ¼
    price_max: float             # æœ€é«˜ä»·æ ¼
    currency: str                # è´§å¸
    variants: List[ProductVariant] = []  # å˜ä½“åˆ—è¡¨
    category: str                # åˆ†ç±»
    priority: str = "P1"         # æµ‹è¯•ä¼˜å…ˆçº§
    selectors: Dict[str, str]    # å…³é”®å…ƒç´ é€‰æ‹©å™¨

    # è‡ªåŠ¨ç”Ÿæˆçš„å…ƒæ•°æ®
    discovered_at: str           # å‘ç°æ—¶é—´
    last_tested: Optional[str]   # ä¸Šæ¬¡æµ‹è¯•æ—¶é—´
```

#### ç»„ä»¶2: é€šç”¨é¡µé¢å¯¹è±¡ï¼ˆGeneric Page Objectsï¼‰

**è®¾è®¡æ€è·¯**: åˆ›å»ºå¯å¤ç”¨çš„é¡µé¢å¯¹è±¡åŸºç±»

```python
# æ–‡ä»¶: pages/base_page.py

class BasePage:
    """æ‰€æœ‰é¡µé¢çš„åŸºç±»"""

    def __init__(self, page: Page, selectors: Dict[str, str]):
        self.page = page
        self.selectors = selectors

    async def click_element(self, selector_key: str):
        """é€šç”¨ç‚¹å‡»æ–¹æ³•"""
        selector = self.selectors.get(selector_key)
        if selector:
            await self.page.click(selector)
        else:
            raise ValueError(f"é€‰æ‹©å™¨ {selector_key} æœªé…ç½®")

    async def fill_input(self, selector_key: str, value: str):
        """é€šç”¨è¾“å…¥æ–¹æ³•"""
        selector = self.selectors.get(selector_key)
        if selector:
            await self.page.fill(selector, value)

class ProductPage(BasePage):
    """å•†å“é¡µé¢ï¼ˆé€šç”¨ï¼‰"""

    async def get_product_title(self) -> str:
        """è·å–å•†å“æ ‡é¢˜"""
        return await self.page.locator(
            self.selectors['product_title']
        ).text_content()

    async def get_price(self) -> str:
        """è·å–ä»·æ ¼"""
        return await self.page.locator(
            self.selectors['product_price']
        ).text_content()

    async def select_variant(self, variant: ProductVariant):
        """é€‰æ‹©å˜ä½“"""
        await self.page.click(variant.selector)

    async def add_to_cart(self):
        """åŠ å…¥è´­ç‰©è½¦"""
        await self.click_element('add_to_cart_button')
```

#### ç»„ä»¶3: è‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆå™¨

```python
# æ–‡ä»¶: core/test_generator.py

class TestGenerator:
    """è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹"""

    def generate_product_tests(self, product: Product) -> str:
        """
        ä¸ºå•ä¸ªå•†å“ç”Ÿæˆæµ‹è¯•ä»£ç 

        ç”Ÿæˆçš„æµ‹è¯•åŒ…æ‹¬:
        1. å•†å“é¡µåŠ è½½æµ‹è¯•
        2. ä»·æ ¼æ˜¾ç¤ºæµ‹è¯•
        3. å˜ä½“é€‰æ‹©æµ‹è¯•ï¼ˆå¦‚æœæœ‰ï¼‰
        4. åŠ è´­æµ‹è¯•
        5. è´­ç‰©è½¦éªŒè¯æµ‹è¯•
        """
        test_code = f'''
@pytest.mark.asyncio
@pytest.mark.product_id("{product.id}")
async def test_{product.id}_page_load(page, product_page_factory):
    """æµ‹è¯• {product.name} é¡µé¢åŠ è½½"""
    product_page = await product_page_factory("{product.url}")

    # éªŒè¯æ ‡é¢˜
    title = await product_page.get_product_title()
    assert "{product.name}" in title or title in "{product.name}"

    # éªŒè¯ä»·æ ¼
    price = await product_page.get_price()
    assert price is not None

@pytest.mark.asyncio
@pytest.mark.product_id("{product.id}")
async def test_{product.id}_add_to_cart(page, product_page_factory):
    """æµ‹è¯• {product.name} åŠ å…¥è´­ç‰©è½¦"""
    product_page = await product_page_factory("{product.url}")

    # é€‰æ‹©ç¬¬ä¸€ä¸ªå˜ä½“ï¼ˆå¦‚æœæœ‰ï¼‰
    {"await product_page.select_variant(variants[0])" if product.variants else "pass"}

    # åŠ å…¥è´­ç‰©è½¦
    await product_page.add_to_cart()

    # éªŒè¯è´­ç‰©è½¦æ›´æ–°
    cart_count = await page.locator('.cart-count').text_content()
    assert int(cart_count) > 0
'''
        return test_code

    def generate_test_suite(self, products: List[Product], output_path: str):
        """æ‰¹é‡ç”Ÿæˆæµ‹è¯•å¥—ä»¶"""
        all_tests = []
        for product in products:
            all_tests.append(self.generate_product_tests(product))

        # å†™å…¥æµ‹è¯•æ–‡ä»¶
        with open(output_path, 'w') as f:
            f.write(TEST_FILE_HEADER)
            f.write('\n\n'.join(all_tests))
```

### 3.3 é…ç½®é©±åŠ¨è®¾è®¡

#### é€‰æ‹©å™¨é…ç½®æ–‡ä»¶

```json
// æ–‡ä»¶: config/selectors.json
{
  "version": "1.0",
  "platform": "shopify",
  "base_selectors": {
    "product_title": ".product-title, h1.product__title, [data-testid='product-title']",
    "product_price": ".product-price, .price, [data-testid='product-price']",
    "add_to_cart_button": "button:has-text('Add to Cart'), button[name='add'], .btn-add-to-cart",
    "cart_count": ".cart-count, .cart-item-count, [data-cart-count]",
    "cart_drawer": ".cart-drawer, #CartDrawer",
    "checkout_button": "button:has-text('Checkout'), a[href*='checkout']"
  },
  "variant_selectors": {
    "color": ".color-swatch, [data-option='Color'] button",
    "size": ".size-option, [data-option='Size'] button"
  },
  "checkout_selectors": {
    "email": "#email, input[name='email']",
    "first_name": "#firstName, input[name='firstName']",
    "last_name": "#lastName, input[name='lastName']",
    "address": "#address1, input[name='address1']",
    "city": "#city, input[name='city']",
    "postal_code": "#zip, input[name='postalCode']",
    "country": "#country, select[name='countryCode']"
  }
}
```

**è¯´æ˜**:
- ä½¿ç”¨å¤šä¸ªå€™é€‰é€‰æ‹©å™¨ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼Œæ¡†æ¶è‡ªåŠ¨å°è¯•
- æ”¯æŒCSSé€‰æ‹©å™¨ã€æ–‡æœ¬é€‰æ‹©å™¨ã€å±æ€§é€‰æ‹©å™¨
- å½“ç½‘ç«™æ”¹ç‰ˆæ—¶ï¼Œä»…éœ€æ›´æ–°æ­¤é…ç½®æ–‡ä»¶

#### æµ‹è¯•ç­–ç•¥é…ç½®

```json
// æ–‡ä»¶: config/test_strategy.json
{
  "discovery": {
    "enabled": true,
    "collections_url": "https://fiido.com/collections",
    "max_products_per_collection": 100,
    "crawl_depth": 2,
    "cache_duration_hours": 24
  },
  "execution": {
    "parallel_workers": 4,
    "retry_failed_tests": 3,
    "retry_delay_seconds": 2,
    "screenshot_on_failure": true,
    "video_on_failure": false
  },
  "coverage": {
    "test_all_variants": true,
    "max_variants_per_product": 5,
    "test_out_of_stock": false
  },
  "priorities": {
    "P0": {
      "description": "æ ¸å¿ƒå•†å“ï¼Œæ¯æ—¥æµ‹è¯•",
      "schedule": "0 */6 * * *"
    },
    "P1": {
      "description": "é‡è¦å•†å“ï¼Œæ¯å‘¨æµ‹è¯•",
      "schedule": "0 2 * * 1"
    },
    "P2": {
      "description": "æ™®é€šå•†å“ï¼ŒæŒ‰éœ€æµ‹è¯•",
      "schedule": "manual"
    }
  }
}
```

---

## 4. å¼€å‘é˜¶æ®µ

### é˜¶æ®µæ¦‚è§ˆ

| é˜¶æ®µ | å‘¨æœŸ | äº¤ä»˜ç‰© | æ ¸å¿ƒåŠŸèƒ½ |
|------|------|--------|---------|
| **é˜¶æ®µ0: æ¡†æ¶æ­å»º** | 3å¤© | é¡¹ç›®ç»“æ„ã€æ ¸å¿ƒç±» | åŸºç¡€æ¶æ„ |
| **é˜¶æ®µ1: çˆ¬è™«å¼€å‘** | 1å‘¨ | äº§å“è‡ªåŠ¨å‘ç° | è‡ªåŠ¨çˆ¬å–å•†å“ |
| **é˜¶æ®µ2: é€šç”¨æµ‹è¯•** | 2å‘¨ | é€šç”¨æµ‹è¯•æ¡†æ¶ | æµ‹è¯•ä»»æ„äº§å“ |
| **é˜¶æ®µ3: å®Œæ•´æµç¨‹** | 2å‘¨ | ç»“è´¦æµç¨‹æµ‹è¯• | ç«¯åˆ°ç«¯æµ‹è¯• |
| **é˜¶æ®µ4: AIé›†æˆ** | 2å‘¨ | æ™ºèƒ½åˆ†æå‘Šè­¦ | AIæŠ¥å‘Šç”Ÿæˆ |

**æ€»å¼€å‘å‘¨æœŸ**: 7-8å‘¨

---

## 5. è¿­ä»£è§„åˆ’

### Sprint 0: æ¡†æ¶æ­å»ºï¼ˆç¬¬1-3å¤©ï¼‰

**ç›®æ ‡**: å»ºç«‹é¡¹ç›®åŸºç¡€æ¶æ„å’Œæ ¸å¿ƒæŠ½è±¡

#### ä»»åŠ¡æ¸…å•

**ç¬¬1å¤©: é¡¹ç›®ç»“æ„**
```bash
fiido-shop-flow-guardian/
â”œâ”€â”€ core/                         # æ ¸å¿ƒæ¡†æ¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crawler.py               # äº§å“çˆ¬è™«
â”‚   â”œâ”€â”€ models.py                # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ test_generator.py       # æµ‹è¯•ç”Ÿæˆå™¨
â”‚   â””â”€â”€ selector_manager.py     # é€‰æ‹©å™¨ç®¡ç†
â”œâ”€â”€ pages/                        # é¡µé¢å¯¹è±¡
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_page.py
â”‚   â”œâ”€â”€ product_page.py
â”‚   â”œâ”€â”€ cart_page.py
â”‚   â””â”€â”€ checkout_page.py
â”œâ”€â”€ tests/                        # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_product_template.py # æµ‹è¯•æ¨¡æ¿
â”‚   â””â”€â”€ generated/               # è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ selectors.json
â”‚   â”œâ”€â”€ test_strategy.json
â”‚   â””â”€â”€ regions.json
â”œâ”€â”€ data/                         # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ discovered_products.json # çˆ¬å–çš„å•†å“
â”‚   â””â”€â”€ test_history.json        # æµ‹è¯•å†å²
â”œâ”€â”€ scripts/                      # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ discover_products.py     # äº§å“å‘ç°
â”‚   â”œâ”€â”€ add_product.py           # æ·»åŠ å•ä¸ªäº§å“
â”‚   â”œâ”€â”€ generate_tests.py        # ç”Ÿæˆæµ‹è¯•
â”‚   â””â”€â”€ analyze_results.py       # ç»“æœåˆ†æ
â”œâ”€â”€ screenshots/                  # æˆªå›¾
â”œâ”€â”€ reports/                      # æŠ¥å‘Š
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ pytest.ini
â””â”€â”€ README.md
```

**ç¬¬2å¤©: æ ¸å¿ƒæ•°æ®æ¨¡å‹**
```python
# æ–‡ä»¶: core/models.py

from pydantic import BaseModel, HttpUrl, Field
from typing import List, Optional, Dict, Literal
from datetime import datetime

class ProductVariant(BaseModel):
    """å•†å“å˜ä½“"""
    name: str
    type: Literal["color", "size", "style", "configuration"]
    selector: str
    available: bool = True
    price_modifier: Optional[float] = None  # ä»·æ ¼å·®å¼‚

class Selectors(BaseModel):
    """å•†å“é¡µé¢é€‰æ‹©å™¨"""
    product_title: str
    product_price: str
    add_to_cart_button: str
    variant_options: Dict[str, str] = {}

    class Config:
        extra = "allow"  # å…è®¸é¢å¤–å­—æ®µ

class Product(BaseModel):
    """å•†å“å®Œæ•´ä¿¡æ¯"""
    id: str = Field(..., description="å•†å“å”¯ä¸€æ ‡è¯†ï¼Œä»URLç”Ÿæˆ")
    name: str
    url: HttpUrl
    category: str
    price_min: float
    price_max: float
    currency: str = "USD"
    variants: List[ProductVariant] = []
    selectors: Selectors
    priority: Literal["P0", "P1", "P2"] = "P1"
    tags: List[str] = []

    # å…ƒæ•°æ®
    discovered_at: datetime = Field(default_factory=datetime.now)
    last_tested: Optional[datetime] = None
    test_status: Literal["untested", "passing", "failing", "flaky"] = "untested"

class TestResult(BaseModel):
    """æµ‹è¯•ç»“æœ"""
    product_id: str
    test_name: str
    status: Literal["passed", "failed", "skipped"]
    duration: float
    error_message: Optional[str] = None
    screenshot_path: Optional[str] = None
    timestamp: datetime = Field(default_factory=datetime.now)
```

**ç¬¬3å¤©: é€‰æ‹©å™¨ç®¡ç†å™¨**
```python
# æ–‡ä»¶: core/selector_manager.py

import json
from pathlib import Path
from typing import Dict, List

class SelectorManager:
    """ç®¡ç†å’Œè§£æé€‰æ‹©å™¨é…ç½®"""

    def __init__(self, config_path: str = "config/selectors.json"):
        self.config_path = Path(config_path)
        self.selectors = self._load_config()

    def _load_config(self) -> Dict:
        """åŠ è½½é€‰æ‹©å™¨é…ç½®"""
        with open(self.config_path) as f:
            return json.load(f)

    def get_selector(self, key: str, fallback: bool = True) -> str:
        """
        è·å–é€‰æ‹©å™¨ï¼Œæ”¯æŒå¤šä¸ªå€™é€‰

        Args:
            key: é€‰æ‹©å™¨é”®åï¼ˆå¦‚ 'product_title'ï¼‰
            fallback: æ˜¯å¦å¯ç”¨åå¤‡é€‰æ‹©å™¨

        Returns:
            é€‰æ‹©å™¨å­—ç¬¦ä¸²ï¼Œå¤šä¸ªé€‰æ‹©å™¨ç”¨é€—å·åˆ†éš”
        """
        base_selectors = self.selectors.get('base_selectors', {})
        selector = base_selectors.get(key, '')

        if not selector and fallback:
            # å°è¯•é€šç”¨åå¤‡
            selector = self._get_fallback_selector(key)

        return selector

    def _get_fallback_selector(self, key: str) -> str:
        """ç”Ÿæˆåå¤‡é€‰æ‹©å™¨"""
        fallbacks = {
            'product_title': 'h1, .title, [class*="product-title"]',
            'product_price': '.price, [class*="price"]',
            'add_to_cart_button': 'button:has-text("Add"), button:has-text("åŠ å…¥")'
        }
        return fallbacks.get(key, '')

    async def find_element(self, page, key: str):
        """
        ä½¿ç”¨é€‰æ‹©å™¨æŸ¥æ‰¾å…ƒç´ ï¼ˆè‡ªåŠ¨å°è¯•å¤šä¸ªé€‰æ‹©å™¨ï¼‰

        Args:
            page: Playwright Pageå¯¹è±¡
            key: é€‰æ‹©å™¨é”®å

        Returns:
            æ‰¾åˆ°çš„å…ƒç´ æˆ–None
        """
        selector = self.get_selector(key)
        selectors = [s.strip() for s in selector.split(',')]

        for sel in selectors:
            try:
                element = page.locator(sel).first
                if await element.count() > 0:
                    return element
            except Exception:
                continue

        return None
```

**äº¤ä»˜ç‰©**:
- âœ… å®Œæ•´é¡¹ç›®ç»“æ„
- âœ… æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼ˆPydanticï¼‰
- âœ… é€‰æ‹©å™¨ç®¡ç†ç³»ç»Ÿ
- âœ… é…ç½®æ–‡ä»¶æ¨¡æ¿

---

### Sprint 1: äº§å“çˆ¬è™«å¼€å‘ï¼ˆç¬¬1å‘¨ï¼‰

**ç›®æ ‡**: å®ç°è‡ªåŠ¨å‘ç°Fiidoç½‘ç«™æ‰€æœ‰å•†å“çš„èƒ½åŠ›

#### å¢é‡ 1.1: åŸºç¡€çˆ¬è™«

```python
# æ–‡ä»¶: core/crawler.py

import requests
from bs4 import BeautifulSoup
from typing import List
from .models import Product, ProductVariant, Selectors
from urllib.parse import urljoin, urlparse
import json
import re

class ProductCrawler:
    """Fiidoç½‘ç«™äº§å“çˆ¬è™«"""

    def __init__(self, base_url: str = "https://fiido.com"):
        self.base_url = base_url
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })

    def discover_collections(self) -> List[str]:
        """
        å‘ç°æ‰€æœ‰å•†å“åˆ†ç±»

        Returns:
            åˆ†ç±»URLåˆ—è¡¨
        """
        collections_url = f"{self.base_url}/collections"
        response = self.session.get(collections_url)
        soup = BeautifulSoup(response.text, 'html.parser')

        collection_links = []
        # Shopifyå…¸å‹çš„åˆ†ç±»é“¾æ¥æ¨¡å¼
        for link in soup.find_all('a', href=True):
            href = link['href']
            if '/collections/' in href and href not in collection_links:
                full_url = urljoin(self.base_url, href)
                collection_links.append(full_url)

        return collection_links

    def get_products_from_collection(self, collection_url: str) -> List[str]:
        """
        ä»åˆ†ç±»é¡µè·å–æ‰€æœ‰å•†å“URL

        Args:
            collection_url: åˆ†ç±»URL

        Returns:
            å•†å“URLåˆ—è¡¨
        """
        # Shopifyæ”¯æŒJSON API
        json_url = f"{collection_url}/products.json"

        try:
            response = self.session.get(json_url)
            data = response.json()

            products = []
            for product in data.get('products', []):
                product_url = f"{self.base_url}/products/{product['handle']}"
                products.append(product_url)

            return products

        except Exception:
            # åå¤‡æ–¹æ¡ˆï¼šè§£æHTML
            return self._parse_collection_html(collection_url)

    def _parse_collection_html(self, collection_url: str) -> List[str]:
        """è§£æåˆ†ç±»é¡µHTMLè·å–å•†å“é“¾æ¥"""
        response = self.session.get(collection_url)
        soup = BeautifulSoup(response.text, 'html.parser')

        products = []
        for link in soup.find_all('a', href=True):
            href = link['href']
            if '/products/' in href:
                full_url = urljoin(self.base_url, href)
                if full_url not in products:
                    products.append(full_url)

        return products

    def extract_product_info(self, product_url: str) -> Product:
        """
        æå–å•ä¸ªå•†å“çš„è¯¦ç»†ä¿¡æ¯

        Args:
            product_url: å•†å“URL

        Returns:
            Productå¯¹è±¡
        """
        # å°è¯•ä½¿ç”¨Shopify Product JSON API
        parsed_url = urlparse(product_url)
        product_handle = parsed_url.path.split('/')[-1]
        json_url = f"{self.base_url}/products/{product_handle}.json"

        try:
            response = self.session.get(json_url)
            data = response.json()
            product_data = data['product']

            # æå–ä»·æ ¼èŒƒå›´
            variants = product_data.get('variants', [])
            prices = [float(v['price']) for v in variants]
            price_min = min(prices) if prices else 0.0
            price_max = max(prices) if prices else 0.0

            # æå–å˜ä½“ä¿¡æ¯
            product_variants = self._extract_variants(product_data)

            # ç”Ÿæˆå•†å“ID
            product_id = product_handle.replace('-', '_')

            # æå–åˆ†ç±»
            category = product_data.get('product_type', 'Unknown')

            # æ„å»ºé€‰æ‹©å™¨ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
            selectors = Selectors(
                product_title=".product-title, h1.product__title",
                product_price=".product-price, .price",
                add_to_cart_button="button[name='add'], button:has-text('Add to Cart')"
            )

            return Product(
                id=product_id,
                name=product_data['title'],
                url=product_url,
                category=category,
                price_min=price_min,
                price_max=price_max,
                currency="USD",  # å¯ä»å˜ä½“ä¸­æå–
                variants=product_variants,
                selectors=selectors,
                tags=product_data.get('tags', [])
            )

        except Exception as e:
            print(f"æ— æ³•ä»JSON APIæå– {product_url}: {e}")
            # åå¤‡ï¼šHTMLè§£æ
            return self._parse_product_html(product_url)

    def _extract_variants(self, product_data: dict) -> List[ProductVariant]:
        """ä»Shopifyäº§å“æ•°æ®æå–å˜ä½“"""
        variants = []
        options = product_data.get('options', [])

        for option in options:
            option_name = option['name']  # å¦‚ "Color"
            option_values = option['values']  # å¦‚ ["Black", "White"]

            variant_type = "color" if "color" in option_name.lower() else "size"

            for value in option_values:
                # ç”Ÿæˆé€‰æ‹©å™¨ï¼ˆéœ€è¦å®é™…æµ‹è¯•è°ƒæ•´ï¼‰
                selector = f'button[data-option-value="{value}"], .variant-option:has-text("{value}")'

                variants.append(ProductVariant(
                    name=value,
                    type=variant_type,
                    selector=selector,
                    available=True  # éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥åº“å­˜
                ))

        return variants

    def _parse_product_html(self, product_url: str) -> Product:
        """åå¤‡æ–¹æ¡ˆï¼šè§£æHTML"""
        response = self.session.get(product_url)
        soup = BeautifulSoup(response.text, 'html.parser')

        # åŸºç¡€æå–é€»è¾‘
        title = soup.find('h1')
        title_text = title.get_text(strip=True) if title else "Unknown"

        # ä»URLç”ŸæˆID
        product_id = product_url.split('/')[-1].replace('-', '_')

        # ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…éœ€è¦æ›´å¤æ‚çš„é€»è¾‘
        return Product(
            id=product_id,
            name=title_text,
            url=product_url,
            category="Unknown",
            price_min=0.0,
            price_max=0.0,
            selectors=Selectors(
                product_title="h1",
                product_price=".price",
                add_to_cart_button="button[name='add']"
            )
        )

    def discover_all_products(self, max_products: int = None) -> List[Product]:
        """
        è‡ªåŠ¨å‘ç°ç½‘ç«™æ‰€æœ‰å•†å“

        Args:
            max_products: æœ€å¤§å•†å“æ•°é‡é™åˆ¶

        Returns:
            Productå¯¹è±¡åˆ—è¡¨
        """
        print(f"ğŸ” å¼€å§‹å‘ç° {self.base_url} çš„æ‰€æœ‰å•†å“...")

        # 1. å‘ç°æ‰€æœ‰åˆ†ç±»
        collections = self.discover_collections()
        print(f"âœ… å‘ç° {len(collections)} ä¸ªå•†å“åˆ†ç±»")

        # 2. ä»æ¯ä¸ªåˆ†ç±»è·å–å•†å“
        all_product_urls = set()
        for collection_url in collections:
            products = self.get_products_from_collection(collection_url)
            all_product_urls.update(products)
            print(f"  ğŸ“¦ {collection_url}: {len(products)} ä¸ªå•†å“")

        print(f"âœ… æ€»å…±å‘ç° {len(all_product_urls)} ä¸ªå”¯ä¸€å•†å“")

        # 3. æå–æ¯ä¸ªå•†å“çš„è¯¦ç»†ä¿¡æ¯
        discovered_products = []
        for i, product_url in enumerate(list(all_product_urls)[:max_products], 1):
            print(f"  ğŸ“ æå– ({i}/{len(all_product_urls)}): {product_url}")
            try:
                product = self.extract_product_info(product_url)
                discovered_products.append(product)
            except Exception as e:
                print(f"  âŒ å¤±è´¥: {e}")

        print(f"ğŸ‰ æˆåŠŸæå– {len(discovered_products)} ä¸ªå•†å“ä¿¡æ¯")

        return discovered_products
```

**ä»»åŠ¡**:
- [ ] T1.1.1: å®ç°åˆ†ç±»å‘ç°é€»è¾‘
- [ ] T1.1.2: å®ç°Shopify JSON APIè§£æ
- [ ] T1.1.3: å®ç°HTMLåå¤‡è§£æ
- [ ] T1.1.4: å®ç°å˜ä½“æå–é€»è¾‘
- [ ] T1.1.5: æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•

#### å¢é‡ 1.2: äº§å“å‘ç°è„šæœ¬

```python
# æ–‡ä»¶: scripts/discover_products.py

import json
import sys
from pathlib import Path
from datetime import datetime

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, str(Path(__file__).parent.parent))

from core.crawler import ProductCrawler
from core.models import Product

def save_products(products: list[Product], output_path: str = "data/discovered_products.json"):
    """ä¿å­˜å‘ç°çš„å•†å“åˆ°JSONæ–‡ä»¶"""
    output_file = Path(output_path)
    output_file.parent.mkdir(parents=True, exist_ok=True)

    # è½¬æ¢ä¸ºJSONå¯åºåˆ—åŒ–æ ¼å¼
    products_data = {
        'last_updated': datetime.now().isoformat(),
        'total_products': len(products),
        'products': [p.model_dump(mode='json') for p in products]
    }

    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(products_data, f, indent=2, ensure_ascii=False)

    print(f"âœ… å·²ä¿å­˜ {len(products)} ä¸ªå•†å“åˆ° {output_file}")

def main():
    """ä¸»å‡½æ•°"""
    import argparse

    parser = argparse.ArgumentParser(description='å‘ç°Fiidoç½‘ç«™æ‰€æœ‰å•†å“')
    parser.add_argument('--base-url', default='https://fiido.com', help='ç½‘ç«™åŸºç¡€URL')
    parser.add_argument('--max-products', type=int, help='æœ€å¤§å•†å“æ•°é‡')
    parser.add_argument('--output', default='data/discovered_products.json', help='è¾“å‡ºæ–‡ä»¶è·¯å¾„')

    args = parser.parse_args()

    # åˆ›å»ºçˆ¬è™«å®ä¾‹
    crawler = ProductCrawler(base_url=args.base_url)

    # å‘ç°æ‰€æœ‰å•†å“
    products = crawler.discover_all_products(max_products=args.max_products)

    # ä¿å­˜ç»“æœ
    save_products(products, args.output)

    # ç»Ÿè®¡ä¿¡æ¯
    print("\nğŸ“Š ç»Ÿè®¡ä¿¡æ¯:")
    print(f"  æ€»å•†å“æ•°: {len(products)}")

    categories = {}
    for p in products:
        categories[p.category] = categories.get(p.category, 0) + 1

    print(f"  åˆ†ç±»åˆ†å¸ƒ:")
    for cat, count in sorted(categories.items(), key=lambda x: -x[1]):
        print(f"    {cat}: {count}")

    variants_count = sum(len(p.variants) for p in products)
    print(f"  å˜ä½“æ€»æ•°: {variants_count}")

if __name__ == '__main__':
    main()
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# å‘ç°æ‰€æœ‰å•†å“
python scripts/discover_products.py

# é™åˆ¶æ•°é‡ï¼ˆæµ‹è¯•ç”¨ï¼‰
python scripts/discover_products.py --max-products 10

# è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„
python scripts/discover_products.py --output data/products_backup.json
```

**ä»»åŠ¡**:
- [ ] T1.2.1: å®ç°å‘½ä»¤è¡Œå‚æ•°è§£æ
- [ ] T1.2.2: å®ç°ç»“æœä¿å­˜é€»è¾‘
- [ ] T1.2.3: æ·»åŠ ç»Ÿè®¡ä¿¡æ¯è¾“å‡º
- [ ] T1.2.4: æ·»åŠ è¿›åº¦æ˜¾ç¤º
- [ ] T1.2.5: å®ç°å¢é‡æ›´æ–°ï¼ˆä»…çˆ¬å–æ–°å•†å“ï¼‰

**Sprint 1 äº¤ä»˜ç‰©**:
- âœ… äº§å“çˆ¬è™«æ ¸å¿ƒåŠŸèƒ½
- âœ… è‡ªåŠ¨å‘ç°æ‰€æœ‰å•†å“
- âœ… æå–å•†å“è¯¦ç»†ä¿¡æ¯ï¼ˆä»·æ ¼ã€å˜ä½“ã€åˆ†ç±»ï¼‰
- âœ… ä¿å­˜ä¸ºç»“æ„åŒ–JSON
- âœ… å‘½ä»¤è¡Œå·¥å…·

---

### Sprint 2: é€šç”¨æµ‹è¯•æ¡†æ¶ï¼ˆç¬¬2-3å‘¨ï¼‰

**ç›®æ ‡**: å®ç°å¯æµ‹è¯•ä»»æ„å•†å“çš„é€šç”¨æµ‹è¯•æ¡†æ¶

#### å¢é‡ 2.1: é€šç”¨é¡µé¢å¯¹è±¡

```python
# æ–‡ä»¶: pages/product_page.py

from playwright.async_api import Page
from typing import Optional
from core.models import Product, ProductVariant
from core.selector_manager import SelectorManager

class ProductPage:
    """é€šç”¨å•†å“é¡µé¢å¯¹è±¡"""

    def __init__(self, page: Page, product: Product):
        self.page = page
        self.product = product
        self.selector_mgr = SelectorManager()

    async def navigate(self):
        """å¯¼èˆªåˆ°å•†å“é¡µ"""
        await self.page.goto(str(self.product.url))
        await self.page.wait_for_load_state('networkidle')

    async def get_title(self) -> Optional[str]:
        """è·å–å•†å“æ ‡é¢˜"""
        element = await self.selector_mgr.find_element(
            self.page,
            'product_title'
        )
        if element:
            return await element.text_content()
        return None

    async def get_price(self) -> Optional[str]:
        """è·å–å•†å“ä»·æ ¼"""
        element = await self.selector_mgr.find_element(
            self.page,
            'product_price'
        )
        if element:
            price_text = await element.text_content()
            return price_text.strip()
        return None

    async def select_variant(self, variant: ProductVariant) -> bool:
        """
        é€‰æ‹©å•†å“å˜ä½“

        Args:
            variant: å˜ä½“å¯¹è±¡

        Returns:
            æ˜¯å¦æˆåŠŸé€‰æ‹©
        """
        try:
            await self.page.click(variant.selector, timeout=3000)
            await self.page.wait_for_timeout(500)  # ç­‰å¾…ä»·æ ¼æ›´æ–°
            return True
        except Exception as e:
            print(f"é€‰æ‹©å˜ä½“å¤±è´¥: {e}")
            return False

    async def add_to_cart(self) -> bool:
        """
        åŠ å…¥è´­ç‰©è½¦

        Returns:
            æ˜¯å¦æˆåŠŸåŠ è´­
        """
        try:
            # ç›‘å¬Consoleé”™è¯¯
            errors = []
            self.page.on('console',
                lambda msg: errors.append(msg.text())
                if msg.type == 'error' else None
            )

            # ç‚¹å‡»åŠ è´­æŒ‰é’®
            add_button = await self.selector_mgr.find_element(
                self.page,
                'add_to_cart_button'
            )

            if not add_button:
                return False

            await add_button.click()

            # ç­‰å¾…è´­ç‰©è½¦æ›´æ–°
            cart_count = await self.selector_mgr.find_element(
                self.page,
                'cart_count'
            )

            if cart_count:
                await cart_count.wait_for(state='visible', timeout=5000)

            # æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
            if errors:
                print(f"åŠ è´­æ—¶æ£€æµ‹åˆ°é”™è¯¯: {errors}")
                return False

            return True

        except Exception as e:
            print(f"åŠ è´­å¤±è´¥: {e}")
            return False

    async def is_in_stock(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦æœ‰è´§"""
        # æ£€æŸ¥"å”®ç½„"æŒ‰é’®
        sold_out_selectors = [
            'button:has-text("Sold Out")',
            'button:has-text("Out of Stock")',
            'button[disabled]:has-text("Add")'
        ]

        for selector in sold_out_selectors:
            try:
                if await self.page.locator(selector).count() > 0:
                    return False
            except:
                pass

        return True
```

#### å¢é‡ 2.2: æµ‹è¯•æ¨¡æ¿ä¸Fixtures

```python
# æ–‡ä»¶: tests/conftest.py

import pytest
import json
from pathlib import Path
from playwright.async_api import async_playwright
from typing import Dict
from core.models import Product
from pages.product_page import ProductPage

@pytest.fixture(scope='session')
def discovered_products() -> Dict[str, Product]:
    """åŠ è½½å·²å‘ç°çš„å•†å“æ•°æ®"""
    data_file = Path('data/discovered_products.json')

    if not data_file.exists():
        pytest.skip("æœªæ‰¾åˆ°å•†å“æ•°æ®ï¼Œè¯·å…ˆè¿è¡Œ discover_products.py")

    with open(data_file) as f:
        data = json.load(f)

    products = {}
    for p_data in data['products']:
        product = Product(**p_data)
        products[product.id] = product

    return products

@pytest.fixture
def product_by_id(discovered_products):
    """é€šè¿‡IDè·å–å•†å“"""
    def _get_product(product_id: str) -> Product:
        if product_id not in discovered_products:
            pytest.skip(f"å•†å“ {product_id} æœªæ‰¾åˆ°")
        return discovered_products[product_id]

    return _get_product

@pytest.fixture
async def product_page_factory(page):
    """äº§å“é¡µé¢å·¥å‚"""
    async def _create_product_page(product: Product) -> ProductPage:
        product_page = ProductPage(page, product)
        await product_page.navigate()
        return product_page

    return _create_product_page

def pytest_generate_tests(metafunc):
    """åŠ¨æ€ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹"""
    if 'test_product' in metafunc.fixturenames:
        # åŠ è½½å•†å“æ•°æ®
        data_file = Path('data/discovered_products.json')
        if not data_file.exists():
            return

        with open(data_file) as f:
            data = json.load(f)

        products = [Product(**p) for p in data['products']]

        # æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤
        priority = metafunc.config.getoption('--priority', None)
        if priority:
            products = [p for p in products if p.priority == priority]

        # æŒ‰åˆ†ç±»è¿‡æ»¤
        category = metafunc.config.getoption('--category', None)
        if category:
            products = [p for p in products if category.lower() in p.category.lower()]

        # å‚æ•°åŒ–æµ‹è¯•
        metafunc.parametrize(
            'test_product',
            products,
            ids=[p.id for p in products]
        )

def pytest_addoption(parser):
    """æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤è¡Œé€‰é¡¹"""
    parser.addoption('--priority', help='æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤: P0/P1/P2')
    parser.addoption('--category', help='æŒ‰åˆ†ç±»è¿‡æ»¤')
    parser.addoption('--product-id', help='æµ‹è¯•æŒ‡å®šå•†å“ID')
```

```python
# æ–‡ä»¶: tests/test_all_products.py

import pytest
from playwright.async_api import Page
from core.models import Product
from pages.product_page import ProductPage

@pytest.mark.asyncio
async def test_product_page_loads(page: Page, test_product: Product, product_page_factory):
    """æµ‹è¯•å•†å“é¡µé¢åŠ è½½"""
    product_page = await product_page_factory(test_product)

    # éªŒè¯æ ‡é¢˜
    title = await product_page.get_title()
    assert title is not None, f"å•†å“ {test_product.id} æ ‡é¢˜æœªåŠ è½½"

    # éªŒè¯æ ‡é¢˜åŒ…å«å•†å“åç§°æˆ–å•†å“åç§°åŒ…å«æ ‡é¢˜
    assert (
        test_product.name.lower() in title.lower() or
        title.lower() in test_product.name.lower()
    ), f"æ ‡é¢˜ä¸åŒ¹é…: æœŸæœ› '{test_product.name}', å®é™… '{title}'"

@pytest.mark.asyncio
async def test_product_price_displays(page: Page, test_product: Product, product_page_factory):
    """æµ‹è¯•å•†å“ä»·æ ¼æ˜¾ç¤º"""
    product_page = await product_page_factory(test_product)

    # éªŒè¯ä»·æ ¼
    price = await product_page.get_price()
    assert price is not None, f"å•†å“ {test_product.id} ä»·æ ¼æœªæ˜¾ç¤º"

    # éªŒè¯ä»·æ ¼åŒ…å«è´§å¸ç¬¦å·æˆ–æ•°å­—
    import re
    assert re.search(r'[\d,\.]+', price), f"ä»·æ ¼æ ¼å¼å¼‚å¸¸: {price}"

@pytest.mark.asyncio
async def test_product_add_to_cart(page: Page, test_product: Product, product_page_factory):
    """æµ‹è¯•å•†å“åŠ å…¥è´­ç‰©è½¦"""
    product_page = await product_page_factory(test_product)

    # æ£€æŸ¥åº“å­˜
    in_stock = await product_page.is_in_stock()
    if not in_stock:
        pytest.skip(f"å•†å“ {test_product.id} ç¼ºè´§")

    # é€‰æ‹©ç¬¬ä¸€ä¸ªå˜ä½“ï¼ˆå¦‚æœæœ‰ï¼‰
    if test_product.variants:
        first_variant = test_product.variants[0]
        variant_selected = await product_page.select_variant(first_variant)
        if not variant_selected:
            pytest.skip(f"æ— æ³•é€‰æ‹©å˜ä½“ {first_variant.name}")

    # åŠ å…¥è´­ç‰©è½¦
    success = await product_page.add_to_cart()
    assert success, f"å•†å“ {test_product.id} åŠ è´­å¤±è´¥"

    # å¤±è´¥æ—¶æˆªå›¾
    if not success:
        await page.screenshot(
            path=f'screenshots/{test_product.id}_add_to_cart_failed.png',
            full_page=True
        )

@pytest.mark.asyncio
@pytest.mark.variants
async def test_product_variant_selection(page: Page, test_product: Product, product_page_factory):
    """æµ‹è¯•å•†å“å˜ä½“é€‰æ‹©"""
    if not test_product.variants:
        pytest.skip(f"å•†å“ {test_product.id} æ— å˜ä½“")

    product_page = await product_page_factory(test_product)

    # æµ‹è¯•æ¯ä¸ªå˜ä½“
    for variant in test_product.variants[:3]:  # æœ€å¤šæµ‹è¯•3ä¸ªå˜ä½“
        success = await product_page.select_variant(variant)
        assert success, f"å˜ä½“ {variant.name} é€‰æ‹©å¤±è´¥"

        # ç­‰å¾…ä»·æ ¼æ›´æ–°
        await page.wait_for_timeout(500)

        # éªŒè¯ä»·æ ¼æ˜¾ç¤º
        price = await product_page.get_price()
        assert price is not None, f"é€‰æ‹©å˜ä½“ {variant.name} åä»·æ ¼æœªæ›´æ–°"
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# æµ‹è¯•æ‰€æœ‰å•†å“
pytest tests/test_all_products.py -v

# ä»…æµ‹è¯•P0å•†å“
pytest tests/test_all_products.py --priority=P0

# ä»…æµ‹è¯•ç”µåŠ¨è‡ªè¡Œè½¦åˆ†ç±»
pytest tests/test_all_products.py --category="Electric Bikes"

# æµ‹è¯•æŒ‡å®šå•†å“
pytest tests/test_all_products.py --product-id=fiido_d11

# å¹¶è¡Œæµ‹è¯•ï¼ˆ4ä¸ªworkerï¼‰
pytest tests/test_all_products.py -n 4

# å¤±è´¥æ—¶æˆªå›¾
pytest tests/test_all_products.py --screenshot=only-on-failure
```

**ä»»åŠ¡**:
- [ ] T2.2.1: å®ç°pytest fixtures
- [ ] T2.2.2: å®ç°åŠ¨æ€æµ‹è¯•ç”Ÿæˆ
- [ ] T2.2.3: å®ç°å•†å“è¿‡æ»¤é€»è¾‘
- [ ] T2.2.4: åˆ›å»ºé€šç”¨æµ‹è¯•ç”¨ä¾‹
- [ ] T2.2.5: æ·»åŠ å¤±è´¥æˆªå›¾åŠŸèƒ½

**Sprint 2 äº¤ä»˜ç‰©**:
- âœ… é€šç”¨é¡µé¢å¯¹è±¡æ¨¡å‹
- âœ… å‚æ•°åŒ–æµ‹è¯•æ¡†æ¶
- âœ… å¯æµ‹è¯•ä»»æ„å•†å“
- âœ… æ”¯æŒè¿‡æ»¤å’Œé€‰æ‹©æ€§æµ‹è¯•
- âœ… è‡ªåŠ¨æˆªå›¾åŠŸèƒ½

---

### Sprint 3: å®Œæ•´è´­ç‰©æµç¨‹ï¼ˆç¬¬4-5å‘¨ï¼‰

**ç›®æ ‡**: å®ç°ç»“è´¦æµç¨‹æµ‹è¯•

#### å¢é‡ 3.1: è´­ç‰©è½¦é¡µé¢

```python
# æ–‡ä»¶: pages/cart_page.py

from playwright.async_api import Page
from core.selector_manager import SelectorManager
from typing import List, Dict

class CartPage:
    """è´­ç‰©è½¦é¡µé¢"""

    def __init__(self, page: Page):
        self.page = page
        self.selector_mgr = SelectorManager()

    async def navigate(self):
        """å¯¼èˆªåˆ°è´­ç‰©è½¦"""
        await self.page.goto('https://fiido.com/cart')
        await self.page.wait_for_load_state('networkidle')

    async def get_cart_items(self) -> List[Dict]:
        """è·å–è´­ç‰©è½¦å•†å“"""
        items = []

        # Shopifyè´­ç‰©è½¦é€šå¸¸æœ‰ .cart-item ç±»
        cart_items = self.page.locator('.cart-item, .cart__item')
        count = await cart_items.count()

        for i in range(count):
            item = cart_items.nth(i)

            # æå–å•†å“ä¿¡æ¯
            name_el = item.locator('.cart-item__name, .cart__item-title').first
            price_el = item.locator('.cart-item__price, .price').first
            qty_el = item.locator('input[type="number"], .cart-item__quantity').first

            item_data = {
                'name': await name_el.text_content() if await name_el.count() > 0 else '',
                'price': await price_el.text_content() if await price_el.count() > 0 else '',
                'quantity': await qty_el.input_value() if await qty_el.count() > 0 else '1'
            }

            items.append(item_data)

        return items

    async def get_total_price(self) -> str:
        """è·å–æ€»ä»·"""
        total_el = await self.selector_mgr.find_element(self.page, 'cart_total')
        if not total_el:
            # åå¤‡é€‰æ‹©å™¨
            total_el = self.page.locator('.cart__total, .cart-total-price').first

        if await total_el.count() > 0:
            return await total_el.text_content()
        return ""

    async def proceed_to_checkout(self):
        """è¿›å…¥ç»“è´¦"""
        checkout_btn = await self.selector_mgr.find_element(self.page, 'checkout_button')
        if checkout_btn:
            await checkout_btn.click()
        else:
            # åå¤‡
            await self.page.click('button:has-text("Checkout"), a:has-text("Checkout")')
```

#### å¢é‡ 3.2: ç»“è´¦æµç¨‹æµ‹è¯•

```python
# æ–‡ä»¶: tests/test_checkout_flow.py

import pytest
from playwright.async_api import Page
from core.models import Product
from pages.product_page import ProductPage
from pages.cart_page import CartPage

# æµ‹è¯•åœ°å€æ•°æ®
TEST_ADDRESSES = {
    "US": {
        "email": "test@fiido-test.com",
        "first_name": "John",
        "last_name": "Doe",
        "address": "123 Test Street",
        "city": "New York",
        "state": "NY",
        "postal_code": "10001",
        "country": "United States"
    },
    "DE": {
        "email": "test@fiido-test.com",
        "first_name": "Max",
        "last_name": "Mustermann",
        "address": "TeststraÃŸe 123",
        "city": "Berlin",
        "postal_code": "10115",
        "country": "Germany"
    }
}

@pytest.mark.asyncio
@pytest.mark.checkout
async def test_full_checkout_flow_us(page: Page, test_product: Product, product_page_factory):
    """æµ‹è¯•å®Œæ•´ç»“è´¦æµç¨‹ï¼ˆç¾å›½ï¼‰"""
    # 1. æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
    product_page = await product_page_factory(test_product)

    if not await product_page.is_in_stock():
        pytest.skip("å•†å“ç¼ºè´§")

    success = await product_page.add_to_cart()
    assert success, "åŠ è´­å¤±è´¥"

    # 2. è¿›å…¥è´­ç‰©è½¦
    cart_page = CartPage(page)
    await cart_page.navigate()

    # éªŒè¯å•†å“åœ¨è´­ç‰©è½¦ä¸­
    items = await cart_page.get_cart_items()
    assert len(items) > 0, "è´­ç‰©è½¦ä¸ºç©º"

    # 3. è¿›å…¥ç»“è´¦
    await cart_page.proceed_to_checkout()

    # ç­‰å¾…ç»“è´¦é¡µåŠ è½½
    await page.wait_for_url('**/checkout/**', timeout=10000)

    # 4. å¡«å†™é…é€ä¿¡æ¯
    address = TEST_ADDRESSES["US"]

    await page.fill('input[name="email"]', address["email"])
    await page.fill('input[name="firstName"]', address["first_name"])
    await page.fill('input[name="lastName"]', address["last_name"])
    await page.fill('input[name="address1"]', address["address"])
    await page.fill('input[name="city"]', address["city"])
    await page.fill('input[name="postalCode"]', address["postal_code"])

    # é€‰æ‹©å›½å®¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
    country_select = page.locator('select[name="countryCode"]')
    if await country_select.count() > 0:
        await country_select.select_option(label=address["country"])

    # 5. éªŒè¯è¿è´¹è®¡ç®—
    await page.wait_for_timeout(2000)  # ç­‰å¾…è¿è´¹è®¡ç®—

    # æ£€æŸ¥æ˜¯å¦æœ‰è¿è´¹æ˜¾ç¤º
    shipping_cost = page.locator('.shipping-cost, [data-shipping-cost]')
    if await shipping_cost.count() > 0:
        cost_text = await shipping_cost.text_content()
        assert cost_text, "è¿è´¹æœªè®¡ç®—"

    # 6. æˆªå›¾è®°å½•
    await page.screenshot(
        path=f'screenshots/checkout_{test_product.id}_us.png',
        full_page=True
    )

    # æ³¨æ„ï¼šä¸å®é™…æäº¤è®¢å•ï¼Œä»¥å…æ±¡æŸ“ç”Ÿäº§æ•°æ®
```

**ä»»åŠ¡**:
- [ ] T3.2.1: å®ç°è´­ç‰©è½¦é¡µé¢å¯¹è±¡
- [ ] T3.2.2: å®ç°ç»“è´¦æµç¨‹æµ‹è¯•
- [ ] T3.2.3: æ·»åŠ å¤šåœ°åŒºæµ‹è¯•æ•°æ®
- [ ] T3.2.4: å®ç°è¿è´¹éªŒè¯
- [ ] T3.2.5: æ·»åŠ æ”¯ä»˜æ–¹å¼é€‰æ‹©æµ‹è¯•ï¼ˆä¸æäº¤ï¼‰

**Sprint 3 äº¤ä»˜ç‰©**:
- âœ… è´­ç‰©è½¦é¡µé¢å¯¹è±¡
- âœ… å®Œæ•´ç»“è´¦æµç¨‹æµ‹è¯•
- âœ… å¤šåœ°åŒºæµ‹è¯•è¦†ç›–
- âœ… è¿è´¹è®¡ç®—éªŒè¯
- âœ… å®‰å…¨æµ‹è¯•ï¼ˆä¸æ±¡æŸ“ç”Ÿäº§æ•°æ®ï¼‰

---

### Sprint 4: AIé›†æˆä¸ä¼˜åŒ–ï¼ˆç¬¬6-7å‘¨ï¼‰

**ç›®æ ‡**: æ·»åŠ AIåˆ†æå’Œæ™ºèƒ½æŠ¥å‘Š

#### å¢é‡ 4.1: AIæŠ¥å‘Šç”Ÿæˆ

```python
# æ–‡ä»¶: scripts/generate_ai_report.py

import json
import os
from pathlib import Path
from datetime import datetime
import anthropic

def generate_ai_report(test_results_path: str = 'test-results.json'):
    """ç”ŸæˆAIé©±åŠ¨çš„æµ‹è¯•æŠ¥å‘Š"""

    # åŠ è½½æµ‹è¯•ç»“æœ
    with open(test_results_path) as f:
        results = json.load(f)

    # è°ƒç”¨Claude API
    client = anthropic.Anthropic(api_key=os.getenv('CLAUDE_API_KEY'))

    prompt = f"""ä½ æ˜¯Fiidoç”µå•†ç½‘ç«™çš„QAä¸“å®¶ã€‚åˆ†æä»¥ä¸‹è‡ªåŠ¨åŒ–æµ‹è¯•ç»“æœå¹¶ç”Ÿæˆä¸“ä¸šæŠ¥å‘Šã€‚

æµ‹è¯•ç»“æœæ‘˜è¦:
{json.dumps(results['summary'], indent=2, ensure_ascii=False)}

å¤±è´¥çš„æµ‹è¯•:
{json.dumps(results.get('failures', [])[:10], indent=2, ensure_ascii=False)}

è¯·ç”ŸæˆåŒ…å«ä»¥ä¸‹å†…å®¹çš„æŠ¥å‘Š:

1. **æ‰§è¡Œæ‘˜è¦** (3-5å¥è¯)
   - æ€»ä½“é€šè¿‡ç‡
   - å…³é”®é—®é¢˜æ•°é‡
   - æµ‹è¯•è¦†ç›–æƒ…å†µ

2. **å¤±è´¥åˆ†æ** (æŒ‰ä¼˜å…ˆçº§åˆ†ç±»)
   - P0: ä¸¥é‡é—®é¢˜ï¼ˆé˜»å¡æ ¸å¿ƒæµç¨‹ï¼‰
   - P1: é«˜ä¼˜å…ˆçº§é—®é¢˜
   - P2: ä¸€èˆ¬é—®é¢˜

   æ¯ä¸ªå¤±è´¥æä¾›:
   - å•†å“åç§°/ID
   - å¤±è´¥åŸå› 
   - å½±å“èŒƒå›´
   - å»ºè®®ä¿®å¤æ–¹æ¡ˆ

3. **è¶‹åŠ¿æ´å¯Ÿ**
   - å“ªäº›å•†å“åˆ†ç±»å¤±è´¥ç‡é«˜
   - æ˜¯å¦æœ‰å…±åŒæ¨¡å¼

4. **è¡ŒåŠ¨å»ºè®®**
   - ä¼˜å…ˆä¿®å¤é¡¹
   - éœ€è¦å…³æ³¨çš„åŒºåŸŸ

ä½¿ç”¨Markdownæ ¼å¼ï¼Œæ¸…æ™°ç®€æ´ã€‚"""

    message = client.messages.create(
        model="claude-sonnet-4-5-20250929",
        max_tokens=4000,
        messages=[{"role": "user", "content": prompt}]
    )

    report = message.content[0].text

    # ä¿å­˜æŠ¥å‘Š
    report_path = Path('reports/latest-ai-report.md')
    report_path.parent.mkdir(parents=True, exist_ok=True)

    with open(report_path, 'w', encoding='utf-8') as f:
        f.write(f"# Fiido E2Eæµ‹è¯•æŠ¥å‘Š\n\n")
        f.write(f"**ç”Ÿæˆæ—¶é—´**: {datetime.now().isoformat()}\n\n")
        f.write(report)

    print(f"âœ… AIæŠ¥å‘Šå·²ç”Ÿæˆ: {report_path}")

    return report

if __name__ == '__main__':
    generate_ai_report()
```

**ä»»åŠ¡**:
- [ ] T4.1.1: å®ç°æµ‹è¯•ç»“æœæ”¶é›†
- [ ] T4.1.2: é›†æˆClaude API
- [ ] T4.1.3: è®¾è®¡æŠ¥å‘Šæç¤ºè¯
- [ ] T4.1.4: å®ç°æŠ¥å‘Šä¿å­˜
- [ ] T4.1.5: æ·»åŠ å¤±è´¥æˆªå›¾åˆ†æ

**Sprint 4 äº¤ä»˜ç‰©**:
- âœ… AIæŠ¥å‘Šç”Ÿæˆ
- âœ… å¤±è´¥åˆ†æ
- âœ… è¶‹åŠ¿æ´å¯Ÿ
- âœ… æ™ºèƒ½å»ºè®®

---

## 6. æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 6.1 å®Œæ•´é¡¹ç›®ç»“æ„

```
fiido-shop-flow-guardian/
â”œâ”€â”€ core/                         # æ ¸å¿ƒæ¡†æ¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crawler.py               # äº§å“çˆ¬è™«
â”‚   â”œâ”€â”€ models.py                # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ selector_manager.py     # é€‰æ‹©å™¨ç®¡ç†
â”‚   â””â”€â”€ test_generator.py       # æµ‹è¯•ç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ pages/                        # é¡µé¢å¯¹è±¡
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_page.py
â”‚   â”œâ”€â”€ product_page.py
â”‚   â”œâ”€â”€ cart_page.py
â”‚   â””â”€â”€ checkout_page.py
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_all_products.py    # æ‰€æœ‰å•†å“æµ‹è¯•
â”‚   â”œâ”€â”€ test_checkout_flow.py  # ç»“è´¦æµç¨‹
â”‚   â””â”€â”€ generated/               # è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•
â”‚
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ selectors.json          # é€‰æ‹©å™¨é…ç½®
â”‚   â”œâ”€â”€ test_strategy.json      # æµ‹è¯•ç­–ç•¥
â”‚   â””â”€â”€ regions.json            # åœ°åŒºé…ç½®
â”‚
â”œâ”€â”€ data/                         # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ discovered_products.json # å‘ç°çš„å•†å“
â”‚   â””â”€â”€ test_history.json       # æµ‹è¯•å†å²
â”‚
â”œâ”€â”€ scripts/                      # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ discover_products.py    # äº§å“å‘ç°
â”‚   â”œâ”€â”€ add_product.py          # æ·»åŠ å•ä¸ªäº§å“
â”‚   â”œâ”€â”€ generate_ai_report.py   # AIæŠ¥å‘Š
â”‚   â””â”€â”€ send_alerts.py          # å‘Šè­¦å‘é€
â”‚
â”œâ”€â”€ screenshots/                  # æˆªå›¾
â”œâ”€â”€ reports/                      # æŠ¥å‘Š
â”œâ”€â”€ .github/workflows/           # CI/CD
â”‚   â””â”€â”€ e2e-test.yml
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ pytest.ini
â””â”€â”€ README.md
```

### 6.2 é…ç½®æ–‡ä»¶ç¤ºä¾‹

```json
// config/selectors.json
{
  "version": "1.0",
  "platform": "shopify",
  "base_selectors": {
    "product_title": ".product__title, h1.product-title, [data-testid='product-title']",
    "product_price": ".price, .product__price, [data-testid='product-price']",
    "add_to_cart_button": "button[name='add'], button:has-text('Add to Cart'), .btn-add-to-cart",
    "cart_count": ".cart-count, .cart-item-count, [data-cart-count]",
    "cart_items": ".cart-item, .cart__item",
    "checkout_button": "button:has-text('Checkout'), a:has-text('Checkout'), [data-testid='checkout']",
    "cart_total": ".cart__total, .cart-total-price"
  },
  "variant_selectors": {
    "color": ".color-swatch button, [data-option='Color'] button",
    "size": ".size-option button, [data-option='Size'] button"
  },
  "checkout_selectors": {
    "email": "input[name='email'], #email",
    "first_name": "input[name='firstName'], #firstName",
    "last_name": "input[name='lastName'], #lastName",
    "address": "input[name='address1'], #address1",
    "city": "input[name='city'], #city",
    "postal_code": "input[name='postalCode'], #zip",
    "country": "select[name='countryCode'], #country"
  }
}
```

---

## 7. ä½¿ç”¨æŒ‡å—

### 7.1 å¿«é€Ÿå¼€å§‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository>
cd fiido-shop-flow-guardian

# 2. å®‰è£…ä¾èµ–
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
playwright install chromium

# 3. å‘ç°æ‰€æœ‰å•†å“
python scripts/discover_products.py

# 4. è¿è¡Œæµ‹è¯•
pytest tests/test_all_products.py -v

# 5. ç”ŸæˆAIæŠ¥å‘Š
export CLAUDE_API_KEY="your-key"
python scripts/generate_ai_report.py
```

### 7.2 æ·»åŠ æ–°äº§å“

**æ–¹å¼1: å•ä¸ªäº§å“URL**
```bash
python scripts/add_product.py --url "https://fiido.com/products/fiido-x-pro"
```

**æ–¹å¼2: é‡æ–°å‘ç°æ‰€æœ‰å•†å“**
```bash
python scripts/discover_products.py
```

**æ–¹å¼3: æ‰‹åŠ¨é…ç½®**
```json
// ç¼–è¾‘ data/discovered_products.json
{
  "products": [
    {
      "id": "new_product",
      "name": "New Product Name",
      "url": "https://fiido.com/products/new-product",
      ...
    }
  ]
}
```

### 7.3 é€‰æ‹©æ€§æµ‹è¯•

```bash
# æµ‹è¯•P0ä¼˜å…ˆçº§å•†å“
pytest tests/ --priority=P0

# æµ‹è¯•ç‰¹å®šåˆ†ç±»
pytest tests/ --category="Electric Bikes"

# æµ‹è¯•å•ä¸ªå•†å“
pytest tests/ --product-id=fiido_d11

# å¹¶è¡Œæµ‹è¯•ï¼ˆ4 workersï¼‰
pytest tests/ -n 4

# ä»…æµ‹è¯•åŠ è´­åŠŸèƒ½
pytest tests/ -k "add_to_cart"
```

### 7.4 CI/CDé›†æˆ

```yaml
# .github/workflows/e2e-test.yml
name: E2E Testing

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯æ—¥å‡Œæ™¨2ç‚¹
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install chromium

      - name: Discover products
        run: python scripts/discover_products.py --max-products 20

      - name: Run tests
        run: pytest tests/ -n 4 --json-report

      - name: Generate AI report
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: python scripts/generate_ai_report.py

      - name: Upload reports
        uses: actions/upload-artifact@v4
        with:
          name: test-reports
          path: reports/
```

---

## 8. éƒ¨ç½²æµæ°´çº¿

### 8.1 æ‰§è¡Œç­–ç•¥

| æ—¶é—´ | é¢‘ç‡ | èŒƒå›´ | ç›®çš„ |
|------|------|------|------|
| **02:00 UTC** | æ¯æ—¥ | å…¨é‡å•†å“ | å…¨é¢æ£€æŸ¥ |
| **æ¯4å°æ—¶** | æ¯æ—¥6æ¬¡ | P0å•†å“ | æ ¸å¿ƒç›‘æ§ |
| **PRæ—¶** | æ¯ä¸ªPR | å˜æ›´ç›¸å…³ | è´¨é‡é—¨ç¦ |
| **æŒ‰éœ€** | æ‰‹åŠ¨ | è‡ªå®šä¹‰ | ç‰¹å®šæµ‹è¯• |

### 8.2 å‘Šè­¦ç­–ç•¥

```python
# scripts/send_alerts.py

def should_alert(results):
    """åˆ¤æ–­æ˜¯å¦å‘é€å‘Šè­¦"""
    # é€šè¿‡ç‡ < 90%
    if results['pass_rate'] < 0.9:
        return True, "é€šè¿‡ç‡è¿‡ä½"

    # P0å•†å“å¤±è´¥
    p0_failures = [f for f in results['failures'] if f.get('priority') == 'P0']
    if p0_failures:
        return True, f"{len(p0_failures)}ä¸ªP0å•†å“å¤±è´¥"

    # è¿ç»­å¤±è´¥
    if results.get('consecutive_failures', 0) >= 3:
        return True, "è¿ç»­å¤±è´¥3æ¬¡"

    return False, ""
```

---

## 9. è´¨é‡é—¨ç¦

### 9.1 å®Œæˆå®šä¹‰ï¼ˆDoDï¼‰

**æ¯ä¸ªSprint**:
- [ ] æ‰€æœ‰è®¡åˆ’åŠŸèƒ½å·²å®ç°
- [ ] ä»£ç å·²å®¡æŸ¥
- [ ] æµ‹è¯•é€šè¿‡ç‡ > 95%
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] CI/CDæµæ°´çº¿é€šè¿‡

**é¡¹ç›®æ•´ä½“**:
- [ ] å¯è‡ªåŠ¨å‘ç°æ‰€æœ‰å•†å“
- [ ] ä»…éœ€URLå³å¯æµ‹è¯•æ–°äº§å“
- [ ] AIæŠ¥å‘Šç”Ÿæˆæ­£å¸¸
- [ ] å‘Šè­¦ç³»ç»Ÿå·¥ä½œ
- [ ] æ€§èƒ½ < 60åˆ†é’Ÿï¼ˆå…¨é‡æµ‹è¯•ï¼‰

### 9.2 æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|----------|
| **äº§å“å‘ç°è¦†ç›–ç‡** | 100% | çˆ¬è™«å‘ç°å•†å“æ•° / å®é™…å•†å“æ•° |
| **æµ‹è¯•è‡ªåŠ¨åŒ–ç‡** | 100% | æ— éœ€æ‰‹åŠ¨ç¼–å†™æ–°æµ‹è¯• |
| **æ–°äº§å“æµ‹è¯•æ—¶é—´** | < 5åˆ†é’Ÿ | ä»æ·»åŠ URLåˆ°æµ‹è¯•å®Œæˆ |
| **å…¨é‡æµ‹è¯•æ—¶é—´** | < 60åˆ†é’Ÿ | CI/CDè¿è¡Œæ—¶é—´ |
| **è¯¯æŠ¥ç‡** | < 5% | é‡è¯•é€šè¿‡çš„å¤±è´¥æµ‹è¯• |

---

## 10. æ‰©å±•æŒ‡å—

### 10.1 æ”¯æŒæ–°äº§å“

**æ­¥éª¤1: æ·»åŠ äº§å“URL**
```bash
python scripts/add_product.py --url "https://fiido.com/products/new-product"
```

**æ­¥éª¤2: éªŒè¯æå–**
```bash
# æŸ¥çœ‹æå–çš„å•†å“ä¿¡æ¯
cat data/discovered_products.json | jq '.products[] | select(.id=="new_product")'
```

**æ­¥éª¤3: è¿è¡Œæµ‹è¯•**
```bash
pytest tests/ --product-id=new_product -v
```

### 10.2 æ”¯æŒæ–°ç½‘ç«™

ä¿®æ”¹`core/crawler.py`ä»¥æ”¯æŒéShopifyç½‘ç«™:

```python
class GenericCrawler(ProductCrawler):
    """é€šç”¨ç”µå•†ç½‘ç«™çˆ¬è™«"""

    def detect_platform(self) -> str:
        """è‡ªåŠ¨æ£€æµ‹ç”µå•†å¹³å°"""
        # æ£€æµ‹Shopify
        if 'myshopify.com' in self.base_url or 'Shopify.theme' in response.text:
            return 'shopify'

        # æ£€æµ‹WooCommerce
        if 'woocommerce' in response.text:
            return 'woocommerce'

        # å…¶ä»–å¹³å°...
        return 'generic'
```

### 10.3 è‡ªå®šä¹‰é€‰æ‹©å™¨

ç¼–è¾‘`config/selectors.json`:

```json
{
  "custom_site_selectors": {
    "product_title": ".your-custom-title-class",
    "add_to_cart_button": "#your-custom-button-id"
  }
}
```

---

## 9. ç”¨æˆ·ç•Œé¢ï¼ˆéæŠ€æœ¯äººå‘˜ä½¿ç”¨ï¼‰

### 9.1 è®¾è®¡ç›®æ ‡

**é—®é¢˜**: å½“å‰æ¡†æ¶éœ€è¦å‘½ä»¤è¡Œæ“ä½œï¼ŒéæŠ€æœ¯äººå‘˜éš¾ä»¥ä½¿ç”¨
**è§£å†³æ–¹æ¡ˆ**: æä¾›å‹å¥½çš„Webç•Œé¢æˆ–æ¡Œé¢åº”ç”¨

### 9.2 Webç®¡ç†ç•Œé¢

#### æ–¹æ¡ˆA: Flask Webåº”ç”¨ï¼ˆæ¨èï¼‰

**æŠ€æœ¯æ ˆ**:
- åç«¯: Flask + RESTful API
- å‰ç«¯: Vue.js 3 + Element Plus
- æ•°æ®åº“: SQLiteï¼ˆå¼€å‘ï¼‰/ PostgreSQLï¼ˆç”Ÿäº§ï¼‰

**é¡¹ç›®ç»“æ„**:
```
fiido-shop-flow-guardian/
â”œâ”€â”€ web/                          # Webç•Œé¢
â”‚   â”œâ”€â”€ backend/                  # Flaskåç«¯
â”‚   â”‚   â”œâ”€â”€ app.py               # ä¸»åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ api/                 # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ products.py      # å•†å“ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ tests.py         # æµ‹è¯•æ‰§è¡Œ
â”‚   â”‚   â”‚   â””â”€â”€ reports.py       # æŠ¥å‘ŠæŸ¥çœ‹
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ tasks/               # åå°ä»»åŠ¡
â”‚   â””â”€â”€ frontend/                 # Vueå‰ç«¯
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ views/           # é¡µé¢ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ components/      # å¯å¤ç”¨ç»„ä»¶
â”‚       â”‚   â””â”€â”€ api/             # APIè°ƒç”¨
â”‚       â””â”€â”€ dist/                # æ„å»ºè¾“å‡º
â””â”€â”€ ... (åŸæœ‰æ–‡ä»¶)
```

**æ ¸å¿ƒåŠŸèƒ½**:

```python
# æ–‡ä»¶: web/backend/app.py

from flask import Flask, jsonify, request
from flask_cors import CORS
import subprocess
import json
from pathlib import Path

app = Flask(__name__)
CORS(app)

@app.route('/api/products/discover', methods=['POST'])
def discover_products():
    """å‘ç°å•†å“API"""
    try:
        # è°ƒç”¨çˆ¬è™«è„šæœ¬
        result = subprocess.run(
            ['python', 'scripts/discover_products.py'],
            capture_output=True,
            text=True,
            timeout=300
        )

        # è¯»å–ç»“æœ
        with open('data/discovered_products.json') as f:
            products = json.load(f)

        return jsonify({
            'success': True,
            'total': products['total_products'],
            'products': products['products']
        })
    except Exception as e:
        return jsonify({'success': False, 'error': str(e)}), 500

@app.route('/api/products', methods=['GET'])
def get_products():
    """è·å–å•†å“åˆ—è¡¨"""
    data_file = Path('data/discovered_products.json')
    if not data_file.exists():
        return jsonify({'products': []})

    with open(data_file) as f:
        data = json.load(f)

    # æ”¯æŒè¿‡æ»¤
    category = request.args.get('category')
    priority = request.args.get('priority')

    products = data['products']
    if category:
        products = [p for p in products if category.lower() in p['category'].lower()]
    if priority:
        products = [p for p in products if p['priority'] == priority]

    return jsonify({'products': products, 'total': len(products)})

@app.route('/api/products/<product_id>', methods=['PUT'])
def update_product(product_id):
    """æ›´æ–°å•†å“é…ç½®ï¼ˆä¼˜å…ˆçº§ç­‰ï¼‰"""
    data_file = Path('data/discovered_products.json')
    with open(data_file) as f:
        products_data = json.load(f)

    update_data = request.json

    # æŸ¥æ‰¾å¹¶æ›´æ–°å•†å“
    for product in products_data['products']:
        if product['id'] == product_id:
            if 'priority' in update_data:
                product['priority'] = update_data['priority']
            break

    # ä¿å­˜
    with open(data_file, 'w') as f:
        json.dump(products_data, f, indent=2)

    return jsonify({'success': True})

@app.route('/api/tests/run', methods=['POST'])
def run_tests():
    """è¿è¡Œæµ‹è¯•API"""
    params = request.json

    # æ„å»ºpytestå‘½ä»¤
    cmd = ['pytest', 'tests/test_all_products.py', '-v', '--json-report']

    if params.get('priority'):
        cmd.extend(['--priority', params['priority']])
    if params.get('category'):
        cmd.extend(['--category', params['category']])
    if params.get('product_id'):
        cmd.extend(['--product-id', params['product_id']])
    if params.get('parallel'):
        cmd.extend(['-n', str(params['parallel'])])

    # å¼‚æ­¥æ‰§è¡Œï¼ˆä½¿ç”¨Celeryæˆ–ç®€å•çš„åå°çº¿ç¨‹ï¼‰
    import threading

    def run_in_background():
        subprocess.run(cmd, capture_output=True, text=True)

    thread = threading.Thread(target=run_in_background)
    thread.start()

    return jsonify({'success': True, 'message': 'æµ‹è¯•å·²å¯åŠ¨'})

@app.route('/api/tests/status', methods=['GET'])
def get_test_status():
    """è·å–æµ‹è¯•çŠ¶æ€"""
    # è¯»å–æœ€æ–°æµ‹è¯•ç»“æœ
    results_file = Path('test-results.json')
    if not results_file.exists():
        return jsonify({'status': 'no_results'})

    with open(results_file) as f:
        results = json.load(f)

    return jsonify({
        'status': 'completed',
        'summary': results.get('summary', {}),
        'failures': results.get('failures', [])
    })

@app.route('/api/reports/latest', methods=['GET'])
def get_latest_report():
    """è·å–æœ€æ–°AIæŠ¥å‘Š"""
    report_file = Path('reports/latest-ai-report.md')
    if not report_file.exists():
        return jsonify({'content': 'æš‚æ— æŠ¥å‘Š'})

    with open(report_file, encoding='utf-8') as f:
        content = f.read()

    return jsonify({'content': content})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
```

**å‰ç«¯é¡µé¢ç¤ºä¾‹**:

```vue
<!-- æ–‡ä»¶: web/frontend/src/views/Dashboard.vue -->

<template>
  <div class="dashboard">
    <el-card class="box-card">
      <template #header>
        <div class="card-header">
          <span>æµ‹è¯•æ¦‚è§ˆ</span>
          <el-button type="primary" @click="discoverProducts">
            ğŸ” å‘ç°å•†å“
          </el-button>
        </div>
      </template>

      <el-row :gutter="20">
        <el-col :span="6">
          <el-statistic title="æ€»å•†å“æ•°" :value="stats.total" />
        </el-col>
        <el-col :span="6">
          <el-statistic title="æµ‹è¯•é€šè¿‡" :value="stats.passed" suffix="ä¸ª" />
        </el-col>
        <el-col :span="6">
          <el-statistic title="æµ‹è¯•å¤±è´¥" :value="stats.failed" suffix="ä¸ª" />
        </el-col>
        <el-col :span="6">
          <el-statistic title="é€šè¿‡ç‡" :value="stats.passRate" suffix="%" />
        </el-col>
      </el-row>
    </el-card>

    <el-card class="box-card" style="margin-top: 20px">
      <template #header>
        <div class="card-header">
          <span>å•†å“åˆ—è¡¨</span>
          <el-space>
            <el-select v-model="filterPriority" placeholder="ä¼˜å…ˆçº§">
              <el-option label="å…¨éƒ¨" value="" />
              <el-option label="P0" value="P0" />
              <el-option label="P1" value="P1" />
              <el-option label="P2" value="P2" />
            </el-select>
            <el-button type="success" @click="runTests">
              â–¶ï¸ è¿è¡Œæµ‹è¯•
            </el-button>
          </el-space>
        </div>
      </template>

      <el-table :data="products" style="width: 100%">
        <el-table-column prop="name" label="å•†å“åç§°" width="300" />
        <el-table-column prop="category" label="åˆ†ç±»" width="150" />
        <el-table-column prop="priority" label="ä¼˜å…ˆçº§" width="100">
          <template #default="scope">
            <el-tag :type="getPriorityType(scope.row.priority)">
              {{ scope.row.priority }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="test_status" label="æµ‹è¯•çŠ¶æ€" width="120">
          <template #default="scope">
            <el-tag :type="getStatusType(scope.row.test_status)">
              {{ scope.row.test_status || 'æœªæµ‹è¯•' }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column label="æ“ä½œ" width="200">
          <template #default="scope">
            <el-button size="small" @click="testSingle(scope.row)">
              æµ‹è¯•
            </el-button>
            <el-button size="small" @click="viewProduct(scope.row)">
              æŸ¥çœ‹
            </el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-card>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import api from '@/api'

const stats = ref({
  total: 0,
  passed: 0,
  failed: 0,
  passRate: 0
})

const products = ref([])
const filterPriority = ref('')

const loadProducts = async () => {
  try {
    const response = await api.get('/products', {
      params: { priority: filterPriority.value }
    })
    products.value = response.data.products
    stats.value.total = response.data.total
  } catch (error) {
    ElMessage.error('åŠ è½½å•†å“å¤±è´¥')
  }
}

const discoverProducts = async () => {
  ElMessage.info('æ­£åœ¨å‘ç°å•†å“ï¼Œè¯·ç¨å€™...')
  try {
    const response = await api.post('/products/discover')
    ElMessage.success(`å‘ç° ${response.data.total} ä¸ªå•†å“`)
    await loadProducts()
  } catch (error) {
    ElMessage.error('å‘ç°å•†å“å¤±è´¥')
  }
}

const runTests = async () => {
  try {
    await api.post('/tests/run', {
      priority: filterPriority.value,
      parallel: 4
    })
    ElMessage.success('æµ‹è¯•å·²å¯åŠ¨ï¼Œè¯·ç¨å€™æŸ¥çœ‹ç»“æœ')
  } catch (error) {
    ElMessage.error('å¯åŠ¨æµ‹è¯•å¤±è´¥')
  }
}

const testSingle = async (product) => {
  try {
    await api.post('/tests/run', {
      product_id: product.id
    })
    ElMessage.success(`å¼€å§‹æµ‹è¯• ${product.name}`)
  } catch (error) {
    ElMessage.error('å¯åŠ¨æµ‹è¯•å¤±è´¥')
  }
}

const getPriorityType = (priority) => {
  const types = { P0: 'danger', P1: 'warning', P2: 'info' }
  return types[priority] || 'info'
}

const getStatusType = (status) => {
  const types = { passing: 'success', failing: 'danger', flaky: 'warning' }
  return types[status] || 'info'
}

onMounted(() => {
  loadProducts()
})
</script>
```

**å¯åŠ¨Webç•Œé¢**:
```bash
# åç«¯
cd web/backend
python app.py

# å‰ç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd web/frontend
npm install
npm run dev

# è®¿é—®: http://localhost:3000
```

### 9.3 æ¡Œé¢åº”ç”¨ï¼ˆå¯é€‰ï¼‰

#### ä½¿ç”¨Electronæ‰“åŒ…

**ä¼˜åŠ¿**:
- è·¨å¹³å°ï¼ˆWindows/macOS/Linuxï¼‰
- ç‹¬ç«‹è¿è¡Œï¼Œæ— éœ€å®‰è£…Python
- æä¾›åŸç”Ÿåº”ç”¨ä½“éªŒ

**æ„å»ºæµç¨‹**:
```bash
# å®‰è£…Electron Builder
npm install -g electron-builder

# æ‰“åŒ…
cd web/frontend
npm run build:electron

# è¾“å‡º
# - fiido-test-guardian-1.0.0-win.exe  (Windows)
# - fiido-test-guardian-1.0.0.dmg      (macOS)
# - fiido-test-guardian-1.0.0.AppImage (Linux)
```

**å‘å¸ƒ**:
- å­˜æ”¾åœ¨å†…ç½‘æ–‡ä»¶æœåŠ¡å™¨
- æˆ–ä¸Šä¼ åˆ°GitHub Releases
- ç”¨æˆ·ä¸‹è½½å®‰è£…å³å¯ä½¿ç”¨

### 9.4 ä½¿ç”¨æµç¨‹ï¼ˆéæŠ€æœ¯äººå‘˜ï¼‰

**æ­¥éª¤1: æ‰“å¼€åº”ç”¨**
```
Windows: åŒå‡» fiido-test-guardian.exe
macOS: æ‰“å¼€ Fiido Test Guardian.app
Web: è®¿é—® http://test-server:5000
```

**æ­¥éª¤2: å‘ç°å•†å“**
```
ç‚¹å‡» "å‘ç°å•†å“" æŒ‰é’®
â†’ ç³»ç»Ÿè‡ªåŠ¨çˆ¬å–fiido.comæ‰€æœ‰å•†å“
â†’ æ˜¾ç¤ºå•†å“åˆ—è¡¨ï¼ˆçº¦2-3åˆ†é’Ÿï¼‰
```

**æ­¥éª¤3: é…ç½®ä¼˜å…ˆçº§**
```
é€‰æ‹©å•†å“ â†’ ç‚¹å‡»"ç¼–è¾‘"
è®¾ç½®ä¼˜å…ˆçº§: P0ï¼ˆæ ¸å¿ƒï¼‰/ P1ï¼ˆé‡è¦ï¼‰/ P2ï¼ˆæ™®é€šï¼‰
ä¿å­˜
```

**æ­¥éª¤4: è¿è¡Œæµ‹è¯•**
```
æ–¹å¼1: ç‚¹å‡»"å…¨éƒ¨æµ‹è¯•"æŒ‰é’®
æ–¹å¼2: ç­›é€‰P0å•†å“ â†’ ç‚¹å‡»"æµ‹è¯•é€‰ä¸­"
æ–¹å¼3: å•ä¸ªå•†å“ â†’ ç‚¹å‡»"æµ‹è¯•"æŒ‰é’®
â†’ æµ‹è¯•è¿è¡Œä¸­ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡
```

**æ­¥éª¤5: æŸ¥çœ‹æŠ¥å‘Š**
```
æµ‹è¯•å®Œæˆåï¼Œç‚¹å‡»"æŸ¥çœ‹æŠ¥å‘Š"
â†’ æ˜¾ç¤ºAIç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Š
â†’ å¤±è´¥å•†å“é«˜äº®æ˜¾ç¤º
â†’ æŸ¥çœ‹å¤±è´¥æˆªå›¾
```

**æ­¥éª¤6: è®¾ç½®å®šæ—¶ä»»åŠ¡**
```
ç‚¹å‡»"è®¾ç½®" â†’ "å®šæ—¶ä»»åŠ¡"
é€‰æ‹©: æ¯æ—¥å‡Œæ™¨2ç‚¹è‡ªåŠ¨è¿è¡Œ
ä¿å­˜ â†’ ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œ
```

---

## 10. éƒ¨ç½²æ–¹æ¡ˆ

### 10.1 éƒ¨ç½²é€‰é¡¹å¯¹æ¯”

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|---------|------|------|
| **æœ¬åœ°è¿è¡Œ** | ä¸ªäººå¼€å‘/æµ‹è¯• | ç®€å•ã€å…è´¹ | éœ€è¦æœ¬åœ°ç¯å¢ƒ |
| **æœåŠ¡å™¨éƒ¨ç½²** | å›¢é˜Ÿä½¿ç”¨ | é›†ä¸­ç®¡ç†ã€å®šæ—¶ä»»åŠ¡ | éœ€è¦æœåŠ¡å™¨ |
| **Dockerå®¹å™¨** | ä»»ä½•ç¯å¢ƒ | éš”ç¦»ã€å¯ç§»æ¤ | éœ€è¦Docker |
| **äº‘æœåŠ¡éƒ¨ç½²** | æ— æœåŠ¡å™¨ç»´æŠ¤ | è‡ªåŠ¨æ‰©å±•ã€é«˜å¯ç”¨ | æŒ‰ä½¿ç”¨ä»˜è´¹ |
| **GitHub Actions** | CI/CDé›†æˆ | å…è´¹é¢åº¦ã€è‡ªåŠ¨åŒ– | ä»…é™å®šæ—¶/äº‹ä»¶è§¦å‘ |

### 10.2 Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

#### æ–¹æ¡ˆä¼˜åŠ¿
- âœ… è·¨å¹³å°ï¼šWindows/macOS/Linuxéƒ½èƒ½è¿è¡Œ
- âœ… ç¯å¢ƒéš”ç¦»ï¼šæ— éœ€å®‰è£…Pythonã€Playwrightç­‰ä¾èµ–
- âœ… ä¸€é”®å¯åŠ¨ï¼š`docker-compose up`å³å¯è¿è¡Œ
- âœ… æ˜“äºè¿ç§»ï¼šå¯éƒ¨ç½²åˆ°ä»»ä½•æ”¯æŒDockerçš„ç¯å¢ƒ

#### Dockerfile

```dockerfile
# æ–‡ä»¶: Dockerfile

FROM python:3.11-slim

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    wget \
    gnupg \
    ca-certificates \
    fonts-liberation \
    libasound2 \
    libatk-bridge2.0-0 \
    libatk1.0-0 \
    libc6 \
    libcairo2 \
    libcups2 \
    libdbus-1-3 \
    libexpat1 \
    libfontconfig1 \
    libgbm1 \
    libgcc1 \
    libglib2.0-0 \
    libgtk-3-0 \
    libnspr4 \
    libnss3 \
    libpango-1.0-0 \
    libpangocairo-1.0-0 \
    libstdc++6 \
    libx11-6 \
    libx11-xcb1 \
    libxcb1 \
    libxcomposite1 \
    libxcursor1 \
    libxdamage1 \
    libxext6 \
    libxfixes3 \
    libxi6 \
    libxrandr2 \
    libxrender1 \
    libxss1 \
    libxtst6 \
    lsb-release \
    xdg-utils \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶requirements
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å®‰è£…Playwrightæµè§ˆå™¨
RUN playwright install chromium

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# æš´éœ²ç«¯å£ï¼ˆWebç•Œé¢ï¼‰
EXPOSE 5000

# å¯åŠ¨å‘½ä»¤
CMD ["python", "web/backend/app.py"]
```

#### Docker Composeé…ç½®

```yaml
# æ–‡ä»¶: docker-compose.yml

version: '3.8'

services:
  test-engine:
    build: .
    container_name: fiido-test-guardian
    ports:
      - "5000:5000"
    volumes:
      - ./data:/app/data
      - ./screenshots:/app/screenshots
      - ./reports:/app/reports
    environment:
      - CLAUDE_API_KEY=${CLAUDE_API_KEY}
      - TEST_BASE_URL=https://fiido.com
    restart: unless-stopped
    networks:
      - test-network

  # å¯é€‰: å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
  scheduler:
    image: mcuadros/ofelia:latest
    container_name: test-scheduler
    depends_on:
      - test-engine
    command: daemon --docker
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    labels:
      ofelia.job-run.discover.schedule: "0 0 2 * * *"  # æ¯æ—¥å‡Œæ™¨2ç‚¹
      ofelia.job-run.discover.container: "fiido-test-guardian"
      ofelia.job-run.discover.command: "python scripts/discover_products.py"
    networks:
      - test-network

networks:
  test-network:
    driver: bridge
```

#### ä¸€é”®å¯åŠ¨

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env <<EOF
CLAUDE_API_KEY=your-api-key-here
EOF

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# è®¿é—®Webç•Œé¢
# http://localhost:5000
```

### 10.3 æœåŠ¡å™¨éƒ¨ç½²

#### UbuntuæœåŠ¡å™¨éƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
sudo apt update
sudo apt install -y python3.11 python3.11-venv python3-pip git nginx

# 2. å…‹éš†é¡¹ç›®
cd /opt
sudo git clone <repository> fiido-test-guardian
cd fiido-test-guardian

# 3. å®‰è£…Pythonä¾èµ–
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
playwright install chromium --with-deps

# 4. é…ç½®ç¯å¢ƒå˜é‡
sudo nano /etc/environment
# æ·»åŠ : CLAUDE_API_KEY=your-key

# 5. åˆ›å»ºsystemdæœåŠ¡
sudo nano /etc/systemd/system/fiido-test-guardian.service
```

**SystemdæœåŠ¡é…ç½®**:
```ini
[Unit]
Description=Fiido Test Guardian Web Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/fiido-test-guardian
Environment="PATH=/opt/fiido-test-guardian/venv/bin"
Environment="CLAUDE_API_KEY=your-api-key"
ExecStart=/opt/fiido-test-guardian/venv/bin/python web/backend/app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable fiido-test-guardian
sudo systemctl start fiido-test-guardian

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status fiido-test-guardian
```

#### Nginxåå‘ä»£ç†é…ç½®

```nginx
# æ–‡ä»¶: /etc/nginx/sites-available/fiido-test-guardian

server {
    listen 80;
    server_name test.yourcompany.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocketæ”¯æŒï¼ˆå¦‚éœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # é™æ€æ–‡ä»¶
    location /reports/ {
        alias /opt/fiido-test-guardian/reports/;
        autoindex on;
    }

    location /screenshots/ {
        alias /opt/fiido-test-guardian/screenshots/;
        autoindex on;
    }
}
```

```bash
# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/fiido-test-guardian /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### å®šæ—¶ä»»åŠ¡é…ç½®

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡
# æ¯æ—¥å‡Œæ™¨2ç‚¹å‘ç°å•†å“
0 2 * * * cd /opt/fiido-test-guardian && /opt/fiido-test-guardian/venv/bin/python scripts/discover_products.py

# æ¯æ—¥å‡Œæ™¨3ç‚¹è¿è¡Œæµ‹è¯•
0 3 * * * cd /opt/fiido-test-guardian && /opt/fiido-test-guardian/venv/bin/pytest tests/ -n 4

# æ¯æ—¥å‡Œæ™¨4ç‚¹ç”ŸæˆæŠ¥å‘Š
0 4 * * * cd /opt/fiido-test-guardian && /opt/fiido-test-guardian/venv/bin/python scripts/generate_ai_report.py
```

### 10.4 Windowséƒ¨ç½²

#### æ–¹æ¡ˆ1: WSL2 + Dockerï¼ˆæ¨èï¼‰

```powershell
# å¯ç”¨WSL2
wsl --install

# å®‰è£…Docker Desktop
# ä¸‹è½½: https://www.docker.com/products/docker-desktop/

# åœ¨WSL2ä¸­è¿è¡Œ
wsl
cd /mnt/c/Users/YourName/fiido-test-guardian
docker-compose up -d
```

#### æ–¹æ¡ˆ2: åŸç”ŸWindowsæœåŠ¡

```powershell
# å®‰è£…Python
# ä¸‹è½½: https://www.python.org/downloads/

# å®‰è£…ä¾èµ–
python -m venv venv
.\venv\Scripts\activate
pip install -r requirements.txt
playwright install chromium

# åˆ›å»ºWindowsæœåŠ¡ï¼ˆä½¿ç”¨NSSMï¼‰
# ä¸‹è½½NSSM: https://nssm.cc/download
nssm install FiidoTestGuardian "C:\path\to\venv\Scripts\python.exe" "C:\path\to\web\backend\app.py"
nssm set FiidoTestGuardian AppDirectory "C:\path\to\fiido-test-guardian"
nssm start FiidoTestGuardian
```

#### Windowså®šæ—¶ä»»åŠ¡

```powershell
# åˆ›å»ºè®¡åˆ’ä»»åŠ¡
$action = New-ScheduledTaskAction -Execute "C:\path\to\venv\Scripts\python.exe" -Argument "C:\path\to\scripts\discover_products.py" -WorkingDirectory "C:\path\to\fiido-test-guardian"

$trigger = New-ScheduledTaskTrigger -Daily -At 2am

Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "Fiido Product Discovery" -Description "è‡ªåŠ¨å‘ç°Fiidoå•†å“"
```

### 10.5 äº‘æœåŠ¡éƒ¨ç½²

#### AWS EC2éƒ¨ç½²

```bash
# 1. åˆ›å»ºEC2å®ä¾‹ï¼ˆUbuntu 22.04ï¼‰
# é€‰æ‹©: t3.mediumï¼ˆ2vCPU, 4GBå†…å­˜ï¼‰

# 2. é…ç½®å®‰å…¨ç»„
# å¼€æ”¾ç«¯å£: 22 (SSH), 80 (HTTP), 443 (HTTPS)

# 3. SSHè¿æ¥
ssh -i your-key.pem ubuntu@ec2-xx-xx-xx-xx.compute.amazonaws.com

# 4. æŒ‰ç…§UbuntuæœåŠ¡å™¨éƒ¨ç½²æµç¨‹å®‰è£…
```

#### Herokuéƒ¨ç½²

```bash
# 1. å®‰è£…Heroku CLI
curl https://cli-assets.heroku.com/install.sh | sh

# 2. ç™»å½•
heroku login

# 3. åˆ›å»ºåº”ç”¨
heroku create fiido-test-guardian

# 4. æ·»åŠ æ„å»ºåŒ…
heroku buildpacks:add heroku/python
heroku buildpacks:add https://github.com/heroku/heroku-buildpack-playwright

# 5. è®¾ç½®ç¯å¢ƒå˜é‡
heroku config:set CLAUDE_API_KEY=your-key

# 6. éƒ¨ç½²
git push heroku main

# 7. æ‰“å¼€åº”ç”¨
heroku open
```

### 10.6 éƒ¨ç½²éªŒè¯

**éªŒè¯æ¸…å•**:
```bash
# 1. æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
curl http://localhost:5000/api/health

# 2. æµ‹è¯•å•†å“å‘ç°
curl -X POST http://localhost:5000/api/products/discover

# 3. æ£€æŸ¥æµ‹è¯•æ‰§è¡Œ
curl http://localhost:5000/api/tests/status

# 4. éªŒè¯æŠ¥å‘Šç”Ÿæˆ
curl http://localhost:5000/api/reports/latest

# 5. æ£€æŸ¥å®šæ—¶ä»»åŠ¡
sudo systemctl status fiido-test-guardian
crontab -l
```

**æ€§èƒ½ç›‘æ§**:
```bash
# CPU/å†…å­˜ä½¿ç”¨
htop

# ç£ç›˜ç©ºé—´
df -h

# æ—¥å¿—æŸ¥çœ‹
journalctl -u fiido-test-guardian -f

# Dockeræ—¥å¿—
docker-compose logs -f test-engine
```

---

## é™„å½•

### A. ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 / macOS / Windows
- **Python**: 3.11+
- **æµè§ˆå™¨**: Chromium/Firefoxï¼ˆè‡ªåŠ¨å®‰è£…ï¼‰
- **å†…å­˜**: æœ€ä½4GBï¼Œæ¨è8GB
- **ç£ç›˜**: æœ€ä½2GB

### B. å¸¸è§é—®é¢˜

**Q: å¦‚ä½•å¤„ç†éœ€è¦ç™»å½•çš„å•†å“ï¼Ÿ**
```python
# åœ¨conftest.pyä¸­æ·»åŠ ç™»å½•fixture
@pytest.fixture(scope='session')
async def authenticated_context(browser):
    context = await browser.new_context()
    page = await context.new_page()

    # ç™»å½•
    await page.goto('https://fiido.com/account/login')
    await page.fill('#email', os.getenv('TEST_EMAIL'))
    await page.fill('#password', os.getenv('TEST_PASSWORD'))
    await page.click('button[type="submit"]')

    # ä¿å­˜ç™»å½•çŠ¶æ€
    await context.storage_state(path='auth.json')
    await context.close()

    # åˆ›å»ºæ–°contextä½¿ç”¨ç™»å½•çŠ¶æ€
    return await browser.new_context(storage_state='auth.json')
```

**Q: å¦‚ä½•æµ‹è¯•ä¸åŒè¯­è¨€ç‰ˆæœ¬ï¼Ÿ**
```python
# æ·»åŠ è¯­è¨€å‚æ•°
@pytest.mark.parametrize('lang', ['en', 'de', 'fr'])
async def test_product_multilang(page, test_product, lang):
    await page.goto(f"{test_product.url}?locale={lang}")
    ...
```

### C. è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æµç¨‹ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤å˜æ›´ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.1
**æœ€åæ›´æ–°**: 2025-12-02
**çŠ¶æ€**: ğŸš€ Sprint 3 å·²å®Œæˆï¼Œè¿›å…¥ Sprint 4

---

## 11. å½“å‰å¼€å‘è¿›åº¦

### 11.1 å·²å®Œæˆçš„ Sprint

#### âœ… Sprint 0: æ¡†æ¶æ­å»ºï¼ˆå·²å®Œæˆï¼‰
**å®Œæˆæ—¶é—´**: 2025-11-28
**ç‰ˆæœ¬æ ‡ç­¾**: v1.0.0

**äº¤ä»˜ç‰©**:
- âœ… å®Œæ•´é¡¹ç›®ç»“æ„
- âœ… æ ¸å¿ƒæ•°æ®æ¨¡å‹ (core/models.py)
- âœ… é€‰æ‹©å™¨ç®¡ç†ç³»ç»Ÿ (core/selector_manager.py)
- âœ… é…ç½®æ–‡ä»¶æ¨¡æ¿

#### âœ… Sprint 1: äº§å“çˆ¬è™«å¼€å‘ï¼ˆå·²å®Œæˆï¼‰
**å®Œæˆæ—¶é—´**: 2025-11-29
**ç‰ˆæœ¬æ ‡ç­¾**: v1.1.0

**äº¤ä»˜ç‰©**:
- âœ… äº§å“çˆ¬è™«æ ¸å¿ƒåŠŸèƒ½ (core/crawler.py)
- âœ… è‡ªåŠ¨å‘ç°æ‰€æœ‰å•†å“
- âœ… æå–å•†å“è¯¦ç»†ä¿¡æ¯ï¼ˆä»·æ ¼ã€å˜ä½“ã€åˆ†ç±»ï¼‰
- âœ… ä¿å­˜ä¸ºç»“æ„åŒ–JSON
- âœ… å‘½ä»¤è¡Œå·¥å…· (scripts/discover_products.py)

**å…³é”®æˆæœ**:
- æˆåŠŸçˆ¬å– Fiido.com æ‰€æœ‰å•†å“
- æ”¯æŒ Shopify JSON API å’Œ HTML åå¤‡è§£æ
- è‡ªåŠ¨æå–å•†å“å˜ä½“å’Œé€‰æ‹©å™¨

#### âœ… Sprint 2: é€šç”¨æµ‹è¯•æ¡†æ¶ï¼ˆå·²å®Œæˆï¼‰
**å®Œæˆæ—¶é—´**: 2025-11-30
**ç‰ˆæœ¬æ ‡ç­¾**: v1.2.0

**äº¤ä»˜ç‰©**:
- âœ… é€šç”¨é¡µé¢å¯¹è±¡æ¨¡å‹ (pages/product_page.py)
- âœ… å‚æ•°åŒ–æµ‹è¯•æ¡†æ¶ (tests/conftest.py)
- âœ… å¯æµ‹è¯•ä»»æ„å•†å“
- âœ… æ”¯æŒè¿‡æ»¤å’Œé€‰æ‹©æ€§æµ‹è¯•
- âœ… è‡ªåŠ¨æˆªå›¾åŠŸèƒ½
- âœ… åŠ¨æ€æµ‹è¯•æ¨¡æ¿

**å…³é”®æˆæœ**:
- å®ç° SelectorManager æ™ºèƒ½é€‰æ‹©å™¨ç®¡ç†
- åŠ¨æ€ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™
- æ”¯æŒæŒ‰ä¼˜å…ˆçº§ã€åˆ†ç±»è¿‡æ»¤æµ‹è¯•
- å¤±è´¥è‡ªåŠ¨æˆªå›¾ï¼Œä¾¿äºè°ƒè¯•

#### âœ… Sprint 3: å®Œæ•´è´­ç‰©æµç¨‹ + AI æ™ºèƒ½æŠ¥å‘Šï¼ˆå·²å®Œæˆï¼‰
**å®Œæˆæ—¶é—´**: 2025-12-02
**ç‰ˆæœ¬æ ‡ç­¾**: v1.3.0

**äº¤ä»˜ç‰©**:
- âœ… è´­ç‰©è½¦é¡µé¢å¯¹è±¡ (pages/cart_page.py)
- âœ… ç»“è´¦é¡µé¢å¯¹è±¡ (pages/checkout_page.py)
- âœ… å®Œæ•´ç»“è´¦æµç¨‹æµ‹è¯•
- âœ… ç«¯åˆ°ç«¯æµ‹è¯•è¦†ç›– (tests/e2e/test_full_checkout_flow.py)
- âœ… AI æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ (scripts/generate_universal_ai_report.py)
- âœ… æ”¯æŒ DeepSeek å’Œ Claude åŒ AI æä¾›å•†
- âœ… æµ‹è¯•ç»“æœæ”¶é›†å™¨ (core/test_result_collector.py)
- âœ… å®Œæ•´æµ‹è¯•æ–‡æ¡£ä½“ç³»

**å…³é”®æˆæœ**:
- å®ç°å•†å“é¡µ â†’ è´­ç‰©è½¦ â†’ ç»“è´¦å®Œæ•´æµç¨‹æµ‹è¯•
- é›†æˆå…è´¹ DeepSeek APIï¼Œå›½å†…å¯ç”¨ï¼Œæ¯æ—¥ 500 ä¸‡ tokens
- AI æŠ¥å‘ŠåŒ…å«å¤±è´¥åˆ†æã€ä¿®å¤å»ºè®®ã€è¶‹åŠ¿æ´å¯Ÿ
- å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2E æµ‹è¯•ä¸‰å±‚è¦†ç›–
- æ–‡æ¡£å®Œæ•´åº¦ 100%ï¼ŒåŒ…å«å¿«é€Ÿå¼€å§‹ã€æµ‹è¯•æŒ‡å—ã€AI é…ç½®æŒ‡å—

**æµ‹è¯•è¦†ç›–ç‡**: 90%+

### 11.2 å½“å‰çŠ¶æ€ï¼ˆ2025-12-02ï¼‰

**é¡¹ç›®è¿›åº¦**: Sprint 3 å®Œæˆï¼Œå‡†å¤‡è¿›å…¥ Sprint 4

**ä»£ç ä»“åº“**: https://github.com/yzh317179958/fiido-shop-flow-guardian

**æœ€æ–°ç‰ˆæœ¬**: v1.3.0

**æ ¸å¿ƒåŠŸèƒ½çŠ¶æ€**:
| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ |
|---------|------|--------|
| å•†å“çˆ¬è™« | âœ… å®Œæˆ | 100% |
| é€šç”¨æµ‹è¯•æ¡†æ¶ | âœ… å®Œæˆ | 100% |
| è´­ç‰©è½¦æµ‹è¯• | âœ… å®Œæˆ | 100% |
| ç»“è´¦æµç¨‹æµ‹è¯• | âœ… å®Œæˆ | 100% |
| AI æ™ºèƒ½æŠ¥å‘Š | âœ… å®Œæˆ | 100% |
| CI/CD é›†æˆ | â³ å¾…å¼€å‘ | 0% |
| å‘Šè­¦ç›‘æ§ | â³ å¾…å¼€å‘ | 0% |
| Web ç®¡ç†ç•Œé¢ | â³ å¾…å¼€å‘ | 0% |

---

## 12. Sprint 4 å¼€å‘è®¡åˆ’ï¼šé«˜çº§åŠŸèƒ½ä¸è‡ªåŠ¨åŒ–

### 12.1 Sprint 4 ç›®æ ‡

**ä¸»é¢˜**: CI/CD é›†æˆã€æ€§èƒ½ä¼˜åŒ–ã€å‘Šè­¦ç›‘æ§

**å‘¨æœŸ**: ç¬¬ 6-7 å‘¨

**æ ¸å¿ƒç›®æ ‡**:
1. âœ… å®ç° GitHub Actions è‡ªåŠ¨åŒ–æµ‹è¯•
2. âœ… å»ºç«‹å‘Šè­¦å’Œç›‘æ§ç³»ç»Ÿ
3. âœ… ä¼˜åŒ–æµ‹è¯•æ€§èƒ½å’Œå¹¶è¡Œæ‰§è¡Œ
4. ğŸ¯ (å¯é€‰) æä¾› Web ç®¡ç†ç•Œé¢

### 12.2 å¢é‡å¼€å‘è®¡åˆ’

#### å¢é‡ 4.1: GitHub Actions CI/CD é›†æˆ (ä¼˜å…ˆçº§: P0)

**ç›®æ ‡**: å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²æµæ°´çº¿

**ä»»åŠ¡æ¸…å•**:
- [ ] T4.1.1: åˆ›å»ºåŸºç¡€ CI/CD å·¥ä½œæµæ–‡ä»¶
- [ ] T4.1.2: é…ç½®å®šæ—¶æµ‹è¯•ä»»åŠ¡ï¼ˆæ¯æ—¥/æ¯å‘¨ï¼‰
- [ ] T4.1.3: å®ç°æµ‹è¯•æŠ¥å‘Šè‡ªåŠ¨ä¸Šä¼ 
- [ ] T4.1.4: é…ç½® Secrets ç®¡ç†ï¼ˆAPI Keysï¼‰
- [ ] T4.1.5: å®ç° PR è§¦å‘æµ‹è¯•
- [ ] T4.1.6: æ·»åŠ æµ‹è¯•ç»“æœå¾½ç« åˆ° README

**äº¤ä»˜ç‰©**:
```
.github/
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ daily-test.yml         # æ¯æ—¥å…¨é‡æµ‹è¯•
â”‚   â”œâ”€â”€ hourly-p0-test.yml     # æ¯å°æ—¶ P0 æµ‹è¯•
â”‚   â”œâ”€â”€ pr-test.yml            # PR è§¦å‘æµ‹è¯•
â”‚   â””â”€â”€ weekly-full-test.yml   # æ¯å‘¨å®Œæ•´æµ‹è¯•
â””â”€â”€ CONTRIBUTING.md            # è´¡çŒ®æŒ‡å—
```

**å®ç°è¦ç‚¹**:
```yaml
# .github/workflows/daily-test.yml
name: Daily E2E Test

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯æ—¥å‡Œæ™¨ 2 ç‚¹ï¼ˆUTCï¼‰
  workflow_dispatch:      # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install chromium --with-deps

      - name: Run tests
        run: |
          pytest tests/ -v -n 4 \
            --html=reports/test-report.html \
            --self-contained-html

      - name: Generate AI report
        if: always()
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          python scripts/generate_universal_ai_report.py \
            --provider deepseek \
            --output reports/ai-report.md

      - name: Upload reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-reports-${{ github.run_number }}
          path: |
            reports/
            screenshots/
          retention-days: 30

      - name: Check test results
        if: failure()
        run: |
          python scripts/send_alerts.py \
            --channel slack \
            --message "Daily test failed! Check reports."
```

#### å¢é‡ 4.2: å‘Šè­¦ä¸ç›‘æ§ç³»ç»Ÿ (ä¼˜å…ˆçº§: P0)

**ç›®æ ‡**: å®ç°æ™ºèƒ½å‘Šè­¦ï¼Œæµ‹è¯•å¤±è´¥æ—¶åŠæ—¶é€šçŸ¥

**ä»»åŠ¡æ¸…å•**:
- [ ] T4.2.1: å®ç°å‘Šè­¦ç­–ç•¥å¼•æ“
- [ ] T4.2.2: é›†æˆ Slack é€šçŸ¥
- [ ] T4.2.3: é›†æˆé‚®ä»¶é€šçŸ¥
- [ ] T4.2.4: é›†æˆä¼ä¸šå¾®ä¿¡é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
- [ ] T4.2.5: å®ç°æµ‹è¯•å†å²è¿½è¸ª
- [ ] T4.2.6: æ·»åŠ è¶‹åŠ¿åˆ†æå’Œå¼‚å¸¸æ£€æµ‹

**äº¤ä»˜ç‰©**:
```
scripts/
â”œâ”€â”€ send_alerts.py              # å‘Šè­¦å‘é€è„šæœ¬
â”œâ”€â”€ check_test_health.py        # æµ‹è¯•å¥åº·æ£€æŸ¥
â””â”€â”€ analyze_trends.py           # è¶‹åŠ¿åˆ†æ

core/
â”œâ”€â”€ alert_engine.py             # å‘Šè­¦å¼•æ“
â””â”€â”€ notification_channels.py   # é€šçŸ¥æ¸ é“

config/
â””â”€â”€ alert_config.json           # å‘Šè­¦é…ç½®
```

**å®ç°è¦ç‚¹**:
```python
# scripts/send_alerts.py

import os
import json
import requests
from typing import Dict, List
from datetime import datetime

class AlertEngine:
    """å‘Šè­¦å¼•æ“"""

    def __init__(self, config_path='config/alert_config.json'):
        self.config = self._load_config(config_path)

    def should_alert(self, test_results: Dict) -> tuple[bool, str]:
        """
        åˆ¤æ–­æ˜¯å¦è§¦å‘å‘Šè­¦

        Returns:
            (æ˜¯å¦å‘Šè­¦, å‘Šè­¦åŸå› )
        """
        reasons = []

        # è§„åˆ™1: é€šè¿‡ç‡ä½äºé˜ˆå€¼
        pass_rate = test_results.get('pass_rate', 0)
        threshold = self.config['thresholds']['pass_rate']
        if pass_rate < threshold:
            reasons.append(f"é€šè¿‡ç‡ {pass_rate:.1%} ä½äºé˜ˆå€¼ {threshold:.1%}")

        # è§„åˆ™2: P0 å•†å“å¤±è´¥
        p0_failures = [
            f for f in test_results.get('failures', [])
            if f.get('priority') == 'P0'
        ]
        if p0_failures:
            reasons.append(f"{len(p0_failures)} ä¸ª P0 æ ¸å¿ƒå•†å“æµ‹è¯•å¤±è´¥")

        # è§„åˆ™3: è¿ç»­å¤±è´¥æ¬¡æ•°
        consecutive = test_results.get('consecutive_failures', 0)
        if consecutive >= 3:
            reasons.append(f"è¿ç»­å¤±è´¥ {consecutive} æ¬¡")

        # è§„åˆ™4: å¤±è´¥æ•°é‡çªå¢
        current_failures = len(test_results.get('failures', []))
        avg_failures = test_results.get('avg_failures_last_7_days', 0)
        if current_failures > avg_failures * 2:
            reasons.append(f"å¤±è´¥æ•°é‡çªå¢ï¼š{current_failures} (å¹³å‡: {avg_failures})")

        return len(reasons) > 0, '\n'.join(reasons)

    def send_alert(self, channel: str, message: str, results: Dict):
        """å‘é€å‘Šè­¦"""
        if channel == 'slack':
            self._send_slack(message, results)
        elif channel == 'email':
            self._send_email(message, results)
        elif channel == 'wechat':
            self._send_wechat(message, results)

    def _send_slack(self, message: str, results: Dict):
        """å‘é€ Slack é€šçŸ¥"""
        webhook_url = os.getenv('SLACK_WEBHOOK_URL')
        if not webhook_url:
            print("âš ï¸ SLACK_WEBHOOK_URL æœªé…ç½®")
            return

        # æ„å»ºå¯Œæ–‡æœ¬æ¶ˆæ¯
        blocks = [
            {
                "type": "header",
                "text": {
                    "type": "plain_text",
                    "text": "ğŸš¨ Fiido E2E æµ‹è¯•å‘Šè­¦"
                }
            },
            {
                "type": "section",
                "fields": [
                    {
                        "type": "mrkdwn",
                        "text": f"*é€šè¿‡ç‡:*\n{results['pass_rate']:.1%}"
                    },
                    {
                        "type": "mrkdwn",
                        "text": f"*å¤±è´¥æ•°:*\n{len(results['failures'])}"
                    },
                    {
                        "type": "mrkdwn",
                        "text": f"*æµ‹è¯•æ—¶é—´:*\n{results['timestamp']}"
                    },
                    {
                        "type": "mrkdwn",
                        "text": f"*è¿è¡ŒID:*\n{results.get('run_id', 'N/A')}"
                    }
                ]
            },
            {
                "type": "section",
                "text": {
                    "type": "mrkdwn",
                    "text": f"*å‘Šè­¦åŸå› :*\n```{message}```"
                }
            }
        ]

        # æ·»åŠ å¤±è´¥å•†å“åˆ—è¡¨
        if results.get('failures'):
            failure_list = '\n'.join([
                f"â€¢ {f['product_name']} ({f['priority']})"
                for f in results['failures'][:5]
            ])
            blocks.append({
                "type": "section",
                "text": {
                    "type": "mrkdwn",
                    "text": f"*Top 5 å¤±è´¥å•†å“:*\n{failure_list}"
                }
            })

        # æ·»åŠ æŠ¥å‘Šé“¾æ¥
        if results.get('report_url'):
            blocks.append({
                "type": "actions",
                "elements": [
                    {
                        "type": "button",
                        "text": {
                            "type": "plain_text",
                            "text": "æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š"
                        },
                        "url": results['report_url']
                    }
                ]
            })

        payload = {"blocks": blocks}

        response = requests.post(webhook_url, json=payload)
        if response.status_code == 200:
            print("âœ… Slack å‘Šè­¦å·²å‘é€")
        else:
            print(f"âŒ Slack å‘Šè­¦å‘é€å¤±è´¥: {response.text}")

    def _send_email(self, message: str, results: Dict):
        """å‘é€é‚®ä»¶é€šçŸ¥"""
        # ä½¿ç”¨ SendGrid æˆ– AWS SES
        import smtplib
        from email.mime.text import MIMEText
        from email.mime.multipart import MIMEMultipart

        sender = os.getenv('ALERT_EMAIL_SENDER')
        recipients = os.getenv('ALERT_EMAIL_RECIPIENTS', '').split(',')
        smtp_server = os.getenv('SMTP_SERVER', 'smtp.gmail.com')
        smtp_port = int(os.getenv('SMTP_PORT', '587'))
        smtp_user = os.getenv('SMTP_USER')
        smtp_password = os.getenv('SMTP_PASSWORD')

        if not all([sender, recipients, smtp_user, smtp_password]):
            print("âš ï¸ é‚®ä»¶é…ç½®ä¸å®Œæ•´")
            return

        # åˆ›å»ºé‚®ä»¶
        msg = MIMEMultipart('alternative')
        msg['Subject'] = f"ğŸš¨ Fiido E2E æµ‹è¯•å‘Šè­¦ - é€šè¿‡ç‡ {results['pass_rate']:.1%}"
        msg['From'] = sender
        msg['To'] = ', '.join(recipients)

        # HTML é‚®ä»¶å†…å®¹
        html = f"""
        <html>
          <body>
            <h2>ğŸš¨ Fiido E2E æµ‹è¯•å‘Šè­¦</h2>
            <table border="1" cellpadding="5">
              <tr><td><b>é€šè¿‡ç‡</b></td><td>{results['pass_rate']:.1%}</td></tr>
              <tr><td><b>å¤±è´¥æ•°é‡</b></td><td>{len(results['failures'])}</td></tr>
              <tr><td><b>æµ‹è¯•æ—¶é—´</b></td><td>{results['timestamp']}</td></tr>
            </table>
            <h3>å‘Šè­¦åŸå› :</h3>
            <pre>{message}</pre>
            <h3>å¤±è´¥å•†å“:</h3>
            <ul>
              {''.join([f"<li>{f['product_name']} ({f['priority']})</li>" for f in results['failures'][:10]])}
            </ul>
            <p><a href="{results.get('report_url', '#')}">æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š</a></p>
          </body>
        </html>
        """

        msg.attach(MIMEText(html, 'html'))

        # å‘é€é‚®ä»¶
        try:
            with smtplib.SMTP(smtp_server, smtp_port) as server:
                server.starttls()
                server.login(smtp_user, smtp_password)
                server.send_message(msg)
            print("âœ… é‚®ä»¶å‘Šè­¦å·²å‘é€")
        except Exception as e:
            print(f"âŒ é‚®ä»¶å‘é€å¤±è´¥: {e}")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    import argparse

    parser = argparse.ArgumentParser(description='å‘é€æµ‹è¯•å‘Šè­¦')
    parser.add_argument('--channel', choices=['slack', 'email', 'wechat'], required=True)
    parser.add_argument('--results-file', default='reports/test-results.json')

    args = parser.parse_args()

    # åŠ è½½æµ‹è¯•ç»“æœ
    with open(args.results_file) as f:
        results = json.load(f)

    # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦
    engine = AlertEngine()
    should_alert, reason = engine.should_alert(results)

    if should_alert:
        print(f"ğŸš¨ è§¦å‘å‘Šè­¦: {reason}")
        engine.send_alert(args.channel, reason, results)
    else:
        print("âœ… æµ‹è¯•é€šè¿‡ï¼Œæ— éœ€å‘Šè­¦")
```

**å‘Šè­¦é…ç½®æ–‡ä»¶**:
```json
// config/alert_config.json
{
  "version": "1.0",
  "enabled": true,
  "thresholds": {
    "pass_rate": 0.90,
    "consecutive_failures": 3,
    "failure_spike_multiplier": 2.0
  },
  "channels": {
    "slack": {
      "enabled": true,
      "webhook_env": "SLACK_WEBHOOK_URL",
      "mention_users": ["@qa-team", "@dev-team"]
    },
    "email": {
      "enabled": true,
      "recipients": ["qa@company.com", "dev@company.com"],
      "smtp_config_env": "SMTP_CONFIG"
    }
  },
  "quiet_hours": {
    "enabled": false,
    "start": "22:00",
    "end": "08:00",
    "timezone": "Asia/Shanghai"
  }
}
```

#### å¢é‡ 4.3: æ€§èƒ½ä¼˜åŒ– (ä¼˜å…ˆçº§: P1)

**ç›®æ ‡**: æå‡æµ‹è¯•æ‰§è¡Œæ•ˆç‡ï¼Œå‡å°‘è¿è¡Œæ—¶é—´

**ä»»åŠ¡æ¸…å•**:
- [ ] T4.3.1: å®ç°æ™ºèƒ½å¹¶è¡Œæµ‹è¯•
- [ ] T4.3.2: ä¼˜åŒ–å•†å“çˆ¬è™«ç¼“å­˜æœºåˆ¶
- [ ] T4.3.3: å®ç°å¢é‡æµ‹è¯•ï¼ˆä»…æµ‹è¯•å˜æ›´å•†å“ï¼‰
- [ ] T4.3.4: ä¼˜åŒ–é¡µé¢åŠ è½½ç­‰å¾…ç­–ç•¥
- [ ] T4.3.5: æ·»åŠ æµ‹è¯•æ‰§è¡Œæ—¶é—´åˆ†æ

**äº¤ä»˜ç‰©**:
- å¹¶è¡Œæµ‹è¯•é…ç½®ä¼˜åŒ–
- çˆ¬è™«ç¼“å­˜ç³»ç»Ÿ
- å¢é‡æµ‹è¯•é€»è¾‘
- æ€§èƒ½åˆ†ææŠ¥å‘Š

#### å¢é‡ 4.4: Web ç®¡ç†ç•Œé¢ (ä¼˜å…ˆçº§: P2, å¯é€‰)

**ç›®æ ‡**: ä¸ºéæŠ€æœ¯äººå‘˜æä¾›å‹å¥½çš„ Web ç•Œé¢

**è¯´æ˜**: æ­¤åŠŸèƒ½ä¸ºå¯é€‰é¡¹ï¼Œå¦‚æœæœ‰éæŠ€æœ¯äººå‘˜éœ€è¦ä½¿ç”¨ï¼Œå¯ä»¥å¼€å‘ã€‚

### 12.3 Sprint 4 å®Œæˆå®šä¹‰ (DoD)

- [ ] GitHub Actions å·¥ä½œæµæ­£å¸¸è¿è¡Œ
- [ ] å®šæ—¶æµ‹è¯•æ¯æ—¥è‡ªåŠ¨æ‰§è¡Œ
- [ ] æµ‹è¯•å¤±è´¥æ—¶èƒ½æ”¶åˆ°å‘Šè­¦é€šçŸ¥
- [ ] æµ‹è¯•æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆå’Œä¸Šä¼ 
- [ ] å¹¶è¡Œæµ‹è¯•æå‡æ•ˆç‡ 50%+
- [ ] æ–‡æ¡£æ›´æ–°å®Œæ•´
- [ ] æ‰€æœ‰åŠŸèƒ½æœ‰å•å…ƒæµ‹è¯•è¦†ç›–

### 12.4 Sprint 4 æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|----------|
| **è‡ªåŠ¨åŒ–ç‡** | 100% | æ— éœ€æ‰‹åŠ¨è§¦å‘æµ‹è¯• |
| **å‘Šè­¦å“åº”æ—¶é—´** | < 5 åˆ†é’Ÿ | ä»å¤±è´¥åˆ°æ”¶åˆ°é€šçŸ¥ |
| **æµ‹è¯•æ‰§è¡Œæ—¶é—´** | < 30 åˆ†é’Ÿ | å…¨é‡æµ‹è¯•å¹¶è¡Œæ‰§è¡Œ |
| **CI/CD æˆåŠŸç‡** | > 95% | Actions æˆåŠŸè¿è¡Œæ¬¡æ•° / æ€»æ¬¡æ•° |

---

**åç»­æ­¥éª¤**:
1. âœ… æ›´æ–°æ–‡æ¡£è®°å½•å½“å‰è¿›åº¦
2. ğŸš€ å¼€å§‹ Sprint 4.1: GitHub Actions CI/CD é›†æˆ
3. ğŸ“ åˆ›å»º Sprint 4 è¯¦ç»†å¼€å‘æ–‡æ¡£
